<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mal Kabul - IMMA</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<!--
================================================================================
IMMA DEVELOPER DOCUMENTATION
================================================================================

SCREEN: 13 GR - Goods Receipt
FILE: goods-receipt.html
LAST UPDATED: 2025-12-23

--------------------------------------------------------------------------------
RELATED DATABASE TABLES
--------------------------------------------------------------------------------

TABLE: Cost (Data Structure IMMA.xlsx - Ana stok/maliyet tablosu)
| Field Name                         | Type     | Length | Description                          |
|------------------------------------|----------|--------|--------------------------------------|
| Cost ID                            | int      | 8      | Primary key - FIFO sƒ±ralamasƒ± i√ßin   |
| Total Quantity                     | float    | 15     | Giri≈ü yapƒ±lan toplam miktar          |
| Total Euro Cost                    | float    | 14     | Toplam Euro maliyeti                 |
| Total TRY Cost                     | float    | 14     | Toplam TL maliyeti                   |
| Consumed Quantity                  | float    | 15     | T√ºketilen/√ßƒ±kƒ±≈ü yapƒ±lan miktar       |
| Consumed Euro Value                | float    | 14     | T√ºketilen Euro deƒüeri                |
| Consumed TRY Value                 | float    | 14     | T√ºketilen TL deƒüeri                  |
| Totally consumed check             | bool     | -      | Stok tamamen t√ºkendi mi?             |
| Storage code                       | text     | 12     | Depo kodu                            |
| Location code                      | text     | 12     | Lokasyon kodu                        |
| Bin code                           | text     | 12     | Bin kodu                             |
| Euro Unit cost                     | float    | 14     | Birim Euro maliyeti                  |
| TRY Unit cost                      | float    | 14     | Birim TL maliyeti                    |
| Orginal currency code              | text     | 3      | Orijinal para birimi (EUR, USD, TRY) |
| Original goods receipt unit price  | float    | 14     | Orijinal birim fiyatƒ±                |
| Goods receipt date time            | datetime | -      | Mal kabul tarihi/saati               |
| Goods receipt document date        | date     | -      | Belge tarihi (irsaliye/fatura)       |
| Material Movement Header number    | int      | 8      | ƒ∞lgili hareket header ID             |
| Material Movement Item number      | int      | 4      | ƒ∞lgili hareket item ID               |
| Block for issue check              | bool     | -      | √áƒ±kƒ±≈ü i√ßin blokaj kontrol√º           |

NOT: Cost tablosu toplamda 20 alan i√ßermektedir. Bu alan FIFO mantƒ±ƒüƒ±yla
stok y√∂netimi ve maliyet takibi i√ßin kullanƒ±lƒ±r.

TABLE: Material Stock (Data Structure IMMA.xlsx)
| Field Name              | Type     | Length | Description                          |
|-------------------------|----------|--------|--------------------------------------|
| Stock Id                | int      | 16     | Primary key                          |
| Quantity                | float    | 15     | Mevcut stok miktarƒ±                  |
| Reserved quantity       | float    | 15     | Rezerve edilmi≈ü miktar               |
| Cost Id                 | int      | 8      | Cost tablosu referansƒ± (FK)          |

NOT: Data Structure'daki Material Stock tablosu yukarƒ±daki alanlarƒ± i√ßerir.
"Material number" ve "Purchasing Order Item Id" alanlarƒ± bu tabloda BULUNMUYOR.
Malzeme-Stok ili≈ükisi Cost tablosu √ºzerinden saƒülanƒ±yor olabilir.

TABLE: Material Movement Item (Hareket kaydƒ± satƒ±r detaylarƒ±)
| Field Name                    | Type     | Length | Description                          |
|-------------------------------|----------|--------|--------------------------------------|
| Material Movement Item Id     | int      | 12     | Primary key                          |
| Material number               | text     | 13     | Malzeme numarasƒ±                     |
| Movement type                 | char     | 1      | Hareket tipi (1-15)                  |
| Quantity                      | float    | 15     | Hareket miktarƒ±                      |
| Storage code                  | text     | 12     | Kaynak depo kodu                     |
| Location code                 | text     | 12     | Kaynak lokasyon kodu                 |
| Bin code                      | text     | 12     | Kaynak bin kodu                      |
| Destination storage code      | text     | 12     | Hedef depo kodu (transfer i√ßin)      |
| Destination location code     | text     | 12     | Hedef lokasyon kodu (transfer i√ßin)  |
| Destination bin code          | text     | 12     | Hedef bin kodu (transfer i√ßin)       |
| Goods receipt document date   | date     | -      | Mal kabul belge tarihi               |
| Cost ID                       | int      | 8      | ƒ∞lgili Cost kaydƒ± (FK)               |
| Movement datetime             | datetime | -      | Hareket tarihi/saati                 |
| Created by user id            | int      | 8      | ƒ∞≈ülemi yapan kullanƒ±cƒ± ID            |
| Document number               | text     | 20     | ƒ∞rsaliye/Fatura numarasƒ±             |
| Material Movement Header number| int     | 8      | ƒ∞lgili header kaydƒ± (FK)             |
| Comment                       | text     | 250    | A√ßƒ±klama/Yorum                       |
| Approver 1 user id            | int      | 8      | 1. Onaylayƒ±cƒ± kullanƒ±cƒ± ID           |
| Approver 2 user id            | int      | 8      | 2. Onaylayƒ±cƒ± kullanƒ±cƒ± ID           |
| Approver 3 user id            | int      | 8      | 3. Onaylayƒ±cƒ± kullanƒ±cƒ± ID           |

NOT: Material Movement Item tablosu t√ºm hareket tiplerinin satƒ±r detaylarƒ±nƒ± i√ßerir.
Header ile Item ili≈ükisi 1:N'dir. Onay alanlarƒ± Approver 1/2/3 ≈üeklinde tutulur.

TABLE: Purchasing Order Item (Sipari≈ü satƒ±rƒ± - referans)
| Field Name                   | Type     | Length | Description                    |
|------------------------------|----------|--------|--------------------------------|
| Purchasing Order item Id     | int      | 12     | Primary key                    |
| Purchasing Order SAP no      | int      | 10     | SAP sipari≈ü numarasƒ±           |
| Purchasing Order SAP Item No | int      | 4      | SAP satƒ±r numarasƒ±             |
| Material number              | text     | 13     | Malzeme numarasƒ±               |
| Unit of measure code         | text     | 3      | √ñl√ß√º birimi                    |
| Order quantity               | float    | 15     | Sipari≈ü miktarƒ±                |
| Goods receipt quantity       | float    | 15     | Teslim alƒ±nan toplam miktar    |
| currency code                | text     | 3      | Para birimi                    |
| Unit price                   | float    | 14     | Birim fiyatƒ±                   |
| creation datetime            | datetime | -      | Kayƒ±t olu≈üturma tarihi/saati   |
| Created by user id           | int      | 8      | Kaydƒ± olu≈üturan kullanƒ±cƒ± ID   |

NOT: Purchasing Order Item toplamda 11 alan i√ßermektedir. SAP entegrasyonu i√ßin
SAP no ve SAP Item No alanlarƒ± kullanƒ±lƒ±r.

Material Movement Types:
| Code | Description                              |
|------|------------------------------------------|
| 1    | Goods Receipt (Mal Kabul)                |
| 2    | Goods Receipt Rollback (Mal Kabul ƒ∞ptali)|
| 3    | Goods Return (Mal ƒ∞ade)                  |
| 4    | Material transfer entry (Depo Giri≈ü)     |
| 5    | Material transfer exit (Depo √áƒ±kƒ±≈ü)      |
| 6    | Goods issue (Malzeme √áƒ±kƒ±≈üƒ±)             |
| 7    | Goods issue rollback (√áƒ±kƒ±≈ü ƒ∞ptali)      |
| 8    | Inventory positive record (+Sayƒ±m Farkƒ±) |
| 9    | Inventory negative record (-Sayƒ±m Farkƒ±) |
| 10   | Packing material receipt (Ambalaj Giri≈ü) |
| 11   | Packing material return (Ambalaj ƒ∞ade)   |
| 12   | Scrapping (Hurda)                        |
| 13   | Scrapping Rollback (Hurda ƒ∞ptali)        |
| 14   | Other material issue (Diƒüer √áƒ±kƒ±≈ü)       |
| 15   | Other material issue rollback            |

--------------------------------------------------------------------------------
SCREEN FIELDS (UI Elements) - Screen Designs: 13 GR
--------------------------------------------------------------------------------

SEARCH AND FILTER SECTION:
- Search box (text) - PO no, SRM no veya malzeme numarasƒ± ara

OPEN PO ITEMS TABLE:
| Column           | Description                        |
|------------------|-----------------------------------|
| Order number     | PO numarasƒ±                        |
| Item number      | PO satƒ±r numarasƒ±                  |
| Material no      | Malzeme numarasƒ±                   |
| Material Title   | Malzeme ba≈ülƒ±ƒüƒ±                    |
| Supplier no      | Tedarik√ßi numarasƒ±                 |
| Supplier Title   | Tedarik√ßi adƒ±                      |
| Unit of measure  | √ñl√ß√º birimi                        |
| Order quantity   | Sipari≈ü miktarƒ±                    |
| Open quantity    | Kalan miktar                       |
| Unit prize       | Birim fiyatƒ±                       |

GOODS RECEIPT FORM:
- Goods receipt Id (readonly) - GR numarasƒ±
- SRM no (readonly) - ƒ∞li≈ükili SRM
- Purchasing Order no (readonly) - ƒ∞li≈ükili PO
- Material number (readonly) - Malzeme numarasƒ±
- Material title (readonly) - Malzeme ba≈ülƒ±ƒüƒ±
- Supplier number (readonly) - Tedarik√ßi no
- Supplier title (readonly) - Tedarik√ßi adƒ±
- Supplier material number (readonly) - Tedarik√ßi malzeme no
- Supplier material title (readonly) - Tedarik√ßi malzeme adƒ±

STORAGE ASSIGNMENT:
- Default storage (dropdown) - Depo se√ßimi
- Default Location (dropdown) - Lokasyon se√ßimi
- Default bin (dropdown) - Bin se√ßimi

COST INFORMATION:
- Cost Id (readonly) - Maliyet kaydƒ± ID
- Euro Unit cost (readonly) - Euro birim maliyeti
- TRY unit cost (readonly) - TL birim maliyeti
- Cost date (date) - Maliyet tarihi

QUANTITY AND DOCUMENT:
- Order quantity (readonly) - Sipari≈ü miktarƒ±
- Receipt quantity (number) - Teslim alƒ±nan miktar
- Invoice number (text) - Fatura numarasƒ±
- Delivery note number (text) - ƒ∞rsaliye numarasƒ±
- Invoice document Date (date) - Fatura tarihi
- Delivery note document date (date) - ƒ∞rsaliye tarihi
- Entry date (readonly) - Kayƒ±t tarihi
- Order closed checkbox - Sipari≈ü kapatƒ±ldƒ± mƒ±

TRANSACTION TYPE:
- Transaction type number (dropdown) - Hareket tipi
- Transaction type title (readonly) - Hareket tipi a√ßƒ±klamasƒ±

LABEL PRINTING:
- Unit quantity in a package (number) - Paket i√ßi birim
- Print label button - Etiket yazdƒ±r
- Label quantity (calculated) - Etiket adedi

STOCK RECORD:
- Stock Record Id (readonly) - Stok kaydƒ± ID
- Previous Stock Record Id (readonly) - √ñnceki stok kaydƒ±
- Stock (readonly) - Depo
- Location (readonly) - Lokasyon
- Bin (readonly) - Bin
- Quantity (readonly) - Miktar

ACTION BUTTONS:
- Process Goods Receipt - Mal kabul i≈üle
- Print Label - Etiket yazdƒ±r
- Rollback - Geri al
- Close Order - Sipari≈üi kapat

--------------------------------------------------------------------------------
BUSINESS RULES (ƒ∞≈ü Kurallarƒ±)
--------------------------------------------------------------------------------

1. Maliyet, FIFO prensibi ve malzeme partisi bazƒ±nda y√∂netilecektir.
2. S√ºre√ß, mal kabul bekleyen a√ßƒ±k satƒ±nalma sipari≈üi kalemleri listesiyle ba≈ülar.
3. T√ºm stok deƒüi≈ütiren aktivitelerin, eylemi tanƒ±mlayan bir kodu ve ba≈ülƒ±ƒüƒ± olmalƒ±dƒ±r: "mal kabul", "tedarik√ßiye iade", "malzeme √ßƒ±kƒ±≈üƒ±", "stok transferi" ve bu eylemlerin geri almalarƒ± gibi.
4. Varsayƒ±lan Depo, lokasyonlar ve binler malzeme ana verisinden doldurulur ve mal kabul ekranƒ±nda gerektiƒüinde deƒüi≈ütirilebilir.
5. Etiket, mal kabul i≈ülem ekranƒ±ndaki bir buton ile yazdƒ±rƒ±lacaktƒ±r.
6. En az bir irsaliye numarasƒ± veya fatura numarasƒ± girilmesi zorunludur. ƒ∞kisi birden girilebilir. Aynƒ± numara ile birden fazla kayƒ±t olu≈üturulabilir ancak birden fazla kayƒ±t olu≈üturulacaksa kullanƒ±cƒ± bilgilendirilmelidir. Tedarik√ßi √∂nceki kayƒ±tlardan farklƒ±ysa ek bir uyarƒ± penceresi g√∂sterilmelidir.
7. A√ßƒ±k satƒ±nalma sipari≈üi listeleri √ºzerinde bir arama kutusu olmalƒ± ve metin girildiƒüinde a√ßƒ±k satƒ±nalma sipari≈üleri filtrelenmelidir.
8. Satƒ±nalma sipari≈üi ekranƒ±, ba≈ülƒ±k ve kalem bilgilerini birlikte i√ßeren bir g√∂r√ºn√ºme sahip olmalƒ±dƒ±r. Mal kabul ekranƒ± da aynƒ± satƒ±nalma sipari≈üi bilgilerine sahip olmalƒ±dƒ±r.
9. Mal kabul belgesi birden fazla sipari≈üten kalemler i√ßerebilir, bu nedenle ekran tasarƒ±mƒ± sipari≈üleri filtrelemeye ve sipari≈ülerden kalemleri mal kabul belgesine eklemeye izin vermelidir.
10. Malzemede paket bilgisi varsa, etiket miktarƒ± hesaplanmalƒ± ve kullanƒ±cƒ±ya g√∂sterilmelidir. Kullanƒ±cƒ± etiket miktarƒ±nƒ± manuel deƒüi≈ütirebilir.
11. Sipari≈ü se√ßim ekranƒ±nda sipari≈üler √ºzerinde malzeme numarasƒ±, sipari≈ü numarasƒ±, SRM numarasƒ± arayan bir arama alanƒ± olmalƒ±dƒ±r. Metin kƒ±smen girilebilir.
12. Satƒ±nalma sipari≈üi orijinal para birimi ve deƒüere sahip olacak, ancak mal kabul kayƒ±tlarƒ± belge tarihindeki kur ile Euro ve TL deƒüerlerine sahip olacaktƒ±r.
13. Mal kabul ekranƒ±nda paket miktarƒ± manuel deƒüi≈ütirildiƒüinde, etiket miktarƒ± otomatik olarak hesaplanacaktƒ±r.
14. Sipari≈üler eksik teslimatla kapatƒ±labilir. Kullanƒ±cƒ±lar kalem i√ßin "Sipari≈ü kapatƒ±ldƒ±" i≈üaretlediƒüinde.
15. Malzemenin varsayƒ±lan depo, lokasyon ve bin numarasƒ± varsa, mal kabulde varsayƒ±lan olmalƒ±dƒ±r. Kullanƒ±cƒ± deƒüi≈ütirmek istediƒüinde, aynƒ± malzemeyi depolayan mevcut binler ve varsayƒ±lan bin √∂nerilmelidir.
16. ƒ∞rsaliye numarasƒ± ve fatura numarasƒ± hareket raporlarƒ±nda bulunmalƒ±dƒ±r.
17. D√∂viz kuru satƒ±≈ü kurudur.

MOVEMENT TYPES (Hareket Tipleri):
T√ºm stok deƒüi≈ütiren aktivitelerin bir kodu ve ba≈ülƒ±ƒüƒ± olmalƒ±dƒ±r:
1-Goods Receipt (Mal Kabul)
2-Goods Receipt Rollback (Mal Kabul ƒ∞ptali)
3-Goods Return (Tedarik√ßiye ƒ∞ade)
4-Material transfer entry (Malzeme Transfer Giri≈üi)
5-Material transfer exit (Malzeme Transfer √áƒ±kƒ±≈üƒ±)
6-Goods issue (Malzeme √áƒ±kƒ±≈üƒ±)
7-Goods issue rollback (Malzeme √áƒ±kƒ±≈ü ƒ∞ptali)
8-Inventory positive (Sayƒ±m Fazlasƒ±)
9-Inventory negative (Sayƒ±m Eksiƒüi)
10-Packing material receipt (Ambalaj Malzemesi Kabul)
11-Packing material return (Ambalaj Malzemesi ƒ∞ade)
12-Scrapping (Hurdaya Ayƒ±rma)
13-Scrapping Rollback (Hurda ƒ∞ptali)
14-Other material issue (Diƒüer Malzeme √áƒ±kƒ±≈üƒ±)
15-Other material issue rollback (Diƒüer Malzeme √áƒ±kƒ±≈ü ƒ∞ptali)

--------------------------------------------------------------------------------
FIELD VALIDATIONS
--------------------------------------------------------------------------------

Zorunlu Alanlar:
- Purchasing Order se√ßimi: ZORUNLU
- Material number: ZORUNLU (PO'dan gelir)
- Teslim miktarƒ±: > 0 ve <= Kalan sipari≈ü miktarƒ±
- ƒ∞rsaliye No VEYA Fatura No: En az biri ZORUNLU
- Goods receipt document date: ZORUNLU

Opsiyonel Alanlar:
- Storage/Location/Bin: Varsayƒ±lan deƒüerler kullanƒ±labilir
- Her iki belge numarasƒ± (irsaliye + fatura)
- Notlar

Hesaplanan Alanlar (READONLY):
- Cost ID: Otomatik artan
- Euro Unit cost
- TRY Unit cost
- Goods receipt date time: Sistem tarihi/saati

--------------------------------------------------------------------------------
WORKFLOW / PROCESS FLOW
--------------------------------------------------------------------------------

MAL KABUL S√úRECƒ∞:
1. Kullanƒ±cƒ± PO (Purchasing Order) se√ßer
2. PO satƒ±rlarƒ± listelenir
3. Teslim alƒ±nacak satƒ±r(lar) se√ßilir
4. Her satƒ±r i√ßin:
   a. Teslim miktarƒ± girilir (max: kalan sipari≈ü)
   b. Birim fiyat doƒürulanƒ±r (PO'dan gelir)
   c. Depo/Lokasyon/Bin se√ßilir veya varsayƒ±lan kullanƒ±lƒ±r
5. Belge bilgileri girilir:
   a. ƒ∞rsaliye numarasƒ± ve/veya
   b. Fatura numarasƒ±
   c. Belge tarihi
6. "Mal Kabul" butonuna tƒ±klanƒ±r
7. Sistem kontrolleri:
   a. Miktar kontrol√º
   b. Belge kontrol√º
   c. Depo aktiflik kontrol√º
8. ƒ∞≈ülem onayƒ±
9. Cost kayƒ±tlarƒ± olu≈üturulur
10. Material Movement kayƒ±tlarƒ± olu≈üturulur (Type=1)
11. PO Goods receipt quantity g√ºncellenir
12. Malzeme Total Stock g√ºncellenir
13. Etiket yazdƒ±rma se√ßeneƒüi sunulur

GERƒ∞ ALMA (ROLLBACK):
1. Mal kabul kaydƒ± se√ßilir
2. Geri alƒ±nacak miktar girilir (max: kalan stok)
3. ƒ∞≈ülem onayƒ±
4. Material Movement kaydƒ± olu≈üturulur (Type=2)
5. Cost kaydƒ± g√ºncellenir (Consumed Quantity artar)
6. PO Goods receipt quantity azalƒ±r

KISMƒ∞ TESLƒ∞MAT:
1. Sipari≈ü miktarƒ±ndan az teslim alƒ±nabilir
2. PO durumu "Kƒ±smen Teslim" olur
3. Kalan miktar i√ßin yeni mal kabul yapƒ±labilir
4. "Sipari≈üi Kapat" ile zorla kapatƒ±labilir

--------------------------------------------------------------------------------
INTEGRATION NOTES
--------------------------------------------------------------------------------

SAP Integration:
- PO bilgileri SAP'dan alƒ±nƒ±r (Purchasing Order SAP number)
- Mal kabul sonrasƒ± SAP'a MIGO i≈ülemi g√∂nderilir
- Hareket tipi: 101 (Goods Receipt)
- Geri alma i√ßin: 102 (Reversal)

Stock Integration:
- Mal kabul sonrasƒ± malzeme Total Stock g√ºncellenir
- Open request quantity deƒüi≈ümez
- Malzeme status "Preparing to be used" (4) ise "Active" (1) olabilir

MRP Integration:
- Mal kabul sonrasƒ± MRP yeniden hesaplanƒ±r
- A√ßƒ±k SRM Suggestion'lar g√ºncellenir
- Reordering point kontrol√º yapƒ±lƒ±r

Accounting Integration:
- Accounting actions required = true ise muhasebe bildirimi
- SAP FI entegrasyonu i√ßin maliyet kayƒ±tlarƒ±

Label Printing:
- Mal kabul sonrasƒ± etiket yazdƒ±rma se√ßeneƒüi
- Etiket adedi = Quantity / Unit quantity in a package
- Barkod: Material number + Cost ID

================================================================================
-->
<body>
    <!-- ============================================
         NAVBAR - Top Navigation (Maximo Style)
         ============================================ -->
    <nav class="modern-navbar">
        <div class="navbar-container">
            <a href="index.html" class="navbar-brand">
                <div class="navbar-logo">M</div>
                <div class="brand-text">
                    <span class="brand-name">IMMA</span>
                    <span class="brand-subtitle">Endirek Malzeme Y√∂netimi</span>
                </div>
            </a>
            <ul class="navbar-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <span class="nav-icon">üìä</span>
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="material-list.html" class="nav-link">
                        <span class="nav-icon">üì¶</span>
                        Ana Veriler
                    </a>
                    <div class="dropdown-menu">
                        <a href="material-list.html" class="dropdown-item">Malzeme Listesi</a>
                        <a href="supplier-list.html" class="dropdown-item">Tedarik√ßi Listesi</a>
                        <a href="storage-type-list.html" class="dropdown-item">Depo Tipi Listesi</a>
                        <a href="number-series.html" class="dropdown-item">Numara Serileri</a>
                        <a href="material-group.html" class="dropdown-item">Malzeme Gruplarƒ±</a>
                        <a href="unit-of-measure-list.html" class="dropdown-item">√ñl√ß√º Birimleri</a>
                        <a href="department-cost-center-list.html" class="dropdown-item">Departman-Masraf Merkezi</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="mrp.html" class="nav-link">
                        <span class="nav-icon">üìà</span>
                        MRP
                    </a>
                </li>
                <li class="nav-item">
                    <a href="srm-list.html" class="nav-link active">
                        <span class="nav-icon">üõí</span>
                        Satƒ±nalma
                    </a>
                    <div class="dropdown-menu">
                        <a href="srm-list.html" class="dropdown-item">Talep Listesi</a>
                        <a href="goods-receipt.html" class="dropdown-item active">Mal Kabul</a>
                        <a href="po-list.html" class="dropdown-item">Satƒ±nalma Sipari≈üleri</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="budget-management.html" class="nav-link">
                        <span class="nav-icon">üí∞</span>
                        Budget
                    </a>
                    <div class="dropdown-menu">
                        <a href="budget-management.html" class="dropdown-item">B√ºt√ße Y√∂netimi</a>
                        <a href="budget-preference.html" class="dropdown-item">B√ºt√ße Tercihleri</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="material-request-list.html" class="nav-link">
                        <span class="nav-icon">üìã</span>
                        Talepler
                    </a>
                    <div class="dropdown-menu">
                        <a href="material-request-list.html" class="dropdown-item">Talep Listesi</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="transfer-list.html" class="nav-link">
                        <span class="nav-icon">üè≠</span>
                        Stock
                    </a>
                    <div class="dropdown-menu">
                        <a href="direct-issue.html" class="dropdown-item">Doƒürudan √áƒ±kƒ±≈ü</a>
                        <a href="warehouse-transfer.html" class="dropdown-item">Depo Transferi</a>
                        <a href="transfer-list.html" class="dropdown-item">Transfer Listesi</a>
                        <a href="inventory-counting.html" class="dropdown-item">Sayƒ±m ƒ∞≈ülemleri</a>
                        <a href="single-material-counting.html" class="dropdown-item">Tekli Malzeme Sayƒ±mƒ±</a>
                        <a href="scrapping.html" class="dropdown-item">Hurda ƒ∞≈ülemleri</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="user-material-limit-list.html" class="nav-link">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        Ayarlar
                    </a>
                    <div class="dropdown-menu">
                        <a href="user-material-limit-list.html" class="dropdown-item">Kullanƒ±cƒ± Malzeme Limitleri</a>
                        <a href="accounting-confirmation.html" class="dropdown-item">Muhasebe Onaylarƒ±</a>
                    </div>
                </li>
            </ul>
            <div class="navbar-user">
                <span class="user-name">Ahmet Yƒ±lmaz</span>
                <div class="user-avatar">AY</div>
            </div>
        </div>
    </nav>

    <!-- ============================================
         MAIN CONTENT - Goods Receipt Page
         ============================================ -->
    <main class="modern-container">
        <!-- Page Header -->
        <div class="page-header">
            <div>
                <h1 class="page-title" id="pageTitle">Mal Kabul ƒ∞≈ülemi</h1>
                <p class="page-subtitle">Satƒ±nalma > Mal Kabul</p>
            </div>
            <div class="page-actions">
                <button class="btn btn-outline" id="grHistoryBtn">üìã Mal Kabul Ge√ßmi≈üi</button>
                <button class="btn btn-warning" id="returnMaterialBtn">‚Ü©Ô∏è Malzeme ƒ∞ade</button>
                <button class="btn btn-warning" id="returnPackingBtn">üì¶ Ambalaj ƒ∞ade</button>
            </div>
        </div>

        <!-- Transaction Type Selection -->
        <div class="card" id="transactionTypeCard">
            <div class="card-header">
                <h3>Operation Type Selection</h3>
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group col-4">
                        <label>Movement type <span class="required">*</span></label>
                        <select class="form-control" id="transactionType" required>
                            <option value="">Se√ßiniz...</option>
                            <option value="101">101 - Mal Kabul (Standart)</option>
                            <option value="102">102 - ƒ∞ptal (Rollback)</option>
                            <option value="122">122 - Malzeme ƒ∞ade</option>
                            <option value="161">161 - Ambalaj ƒ∞ade</option>
                        </select>
                    </div>
                    <div class="form-group col-4">
                        <label>Movement type Description</label>
                        <input type="text" class="form-control" id="transactionTypeTitle" readonly>
                    </div>
                    <div class="form-group col-4">
                        <label>&nbsp;</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================
             SECTION 1: OPEN ORDERS - Search/Filter & List
             ============================================ -->
        <div class="card" id="openOrdersSection">
            <div class="card-header">
                <h3>Search / Filter Open Orders</h3>
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group col-3">
                        <label>Search</label>
                        <input type="text" class="form-control" id="searchBox" placeholder="Sipari≈ü, malzeme veya tedarik√ßi ara...">
                    </div>
                    <div class="form-group col-2">
                        <label>Order number</label>
                        <input type="text" class="form-control" id="filterOrderNo" placeholder="4500012345">
                    </div>
                    <div class="form-group col-2">
                        <label>Item number No</label>
                        <input type="text" class="form-control" id="filterItemNo" placeholder="10">
                    </div>
                    <div class="form-group col-2">
                        <label>Material number</label>
                        <input type="text" class="form-control" id="filterMaterialNo" placeholder="01.00002-0001">
                    </div>
                    <div class="form-group col-3">
                        <label>Material title</label>
                        <input type="text" class="form-control" id="filterMaterialTitle" placeholder="Rulman">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-2">
                        <label>Supplier number</label>
                        <input type="text" class="form-control" id="filterSupplierNo" placeholder="1000045678">
                    </div>
                    <div class="form-group col-3">
                        <label>Supplier title</label>
                        <input type="text" class="form-control" id="filterSupplierTitle" placeholder="ABC End√ºstriyel">
                    </div>
                    <div class="form-group col-2">
                        <label>Unit of measure</label>
                        <select class="form-control" id="filterUOM">
                            <option value="">T√ºm√º</option>
                            <option>AD</option>
                            <option>KG</option>
                            <option>LT</option>
                            <option>MT</option>
                        </select>
                    </div>
                    <div class="form-group col-2">
                        <label>&nbsp;</label>
                        <button class="btn btn-primary btn-block" id="searchBtn">üîç Ara</button>
                    </div>
                    <div class="form-group col-2">
                        <label>&nbsp;</label>
                        <button class="btn btn-outline btn-block" id="clearFilterBtn">Filtreleri Temizle</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Open PO Items List -->
        <div class="card" id="openItemsListCard">
            <div class="card-header">
                <h3>Pending Order Items for Goods Receipt</h3>
                <div class="card-header-actions">
                    <label style="margin-right: 15px; display: inline-flex; align-items: center;">
                        <input type="checkbox" id="selectAllItems" style="margin-right: 5px;">
                        T√ºm√ºn√º Se√ß
                    </label>
                    <span class="status-badge status-active" id="openItemsCount">3 A√ßƒ±k Item number</span>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive-wrapper">
                <table class="table pending-items-table" style="font-size: 12px; min-width: 1400px;">
                    <thead>
                        <tr>
                            <th style="width: 40px;">Se√ß</th>
                            <th style="width: 50px;">Exclude</th>
                            <th>Order number</th>
                            <th>Item number</th>
                            <th>Material number</th>
                            <th>Material title</th>
                            <th>Supplier material number</th>
                            <th>Supplier material title</th>
                            <th>Supplier number</th>
                            <th>Supplier title</th>
                            <th>Unit of measure</th>
                            <th>Order quantity</th>
                            <th>Open quantity</th>
                            <th>Unit price</th>
                            <th>Currency</th>
                        </tr>
                    </thead>
                    <tbody id="openItemsTable">
                        <tr class="table-row-clickable" data-po-item="1">
                            <td><input type="checkbox" class="item-select" name="selectedItems" value="1"></td>
                            <td><input type="checkbox" class="item-exclude" data-item="1"></td>
                            <td>4500012345</td>
                            <td>10</td>
                            <td>01.00002-0001</td>
                            <td>Rulman 6205-2RS SKF</td>
                            <td>SKF-6205-2RS</td>
                            <td>Rulman 6205 2RS</td>
                            <td>1000045678</td>
                            <td>ABC End√ºstriyel Malzeme A.≈û.</td>
                            <td>AD</td>
                            <td>100</td>
                            <td><strong>100</strong></td>
                            <td>125.50</td>
                            <td>EUR</td>
                        </tr>
                        <tr class="table-row-clickable" data-po-item="2">
                            <td><input type="checkbox" class="item-select" name="selectedItems" value="2"></td>
                            <td><input type="checkbox" class="item-exclude" data-item="2"></td>
                            <td>4500012345</td>
                            <td>20</td>
                            <td>01.00015-0003</td>
                            <td>Hidrolik Yag ISO 46</td>
                            <td>HYD-ISO46-200</td>
                            <td>Hidrolik Yag ISO 46</td>
                            <td>1000045678</td>
                            <td>ABC End√ºstriyel Malzeme A.≈û.</td>
                            <td>LT</td>
                            <td>200</td>
                            <td><strong>200</strong></td>
                            <td>45.00</td>
                            <td>EUR</td>
                        </tr>
                        <tr class="table-row-clickable" data-po-item="3">
                            <td><input type="checkbox" class="item-select" name="selectedItems" value="3"></td>
                            <td><input type="checkbox" class="item-exclude" data-item="3"></td>
                            <td>4500012346</td>
                            <td>10</td>
                            <td>01.00028-0001</td>
                            <td>Elektrik Motoru 5.5kW</td>
                            <td>MOT-5500W-380</td>
                            <td>Electric Motor 5.5kW</td>
                            <td>1000045679</td>
                            <td>XYZ Elektrik San. Tic. Ltd.</td>
                            <td>AD</td>
                            <td>5</td>
                            <td><strong>5</strong></td>
                            <td>1850.00</td>
                            <td>EUR</td>
                        </tr>
                    </tbody>
                </table>
                </div>
                <!-- Scroll Indicator -->
                <div class="scroll-indicator">
                    <span>‚Üê Kaydƒ±rƒ±n ‚Üí</span>
                </div>
            </div>
        </div>

        <!-- ============================================
             SECTION 2: RECEIPT FORM - Appears When Item Selected
             ============================================ -->
        <div class="card" id="receiptFormSection" style="display: none;">
            <div class="card-header">
                <h3>Mal Kabul Formu</h3>
                <div class="card-header-actions">
                    <button class="btn btn-outline btn-sm" id="closeFormBtn">‚úï Kapat</button>
                </div>
            </div>
            <div class="card-body">
                <!-- Document Header Information - Screen Designs 13 GR -->
                <div class="form-row">
                    <div class="form-group col-3">
                        <label>Mal Kabul No (GR ID)</label>
                        <input type="text" class="form-control" id="grId" readonly style="background-color: #e8f5e9; font-weight: bold;">
                        <small class="form-text text-muted">Sistem otomatik olu≈üturur</small>
                    </div>
                    <div class="form-group col-3">
                        <label>Entry date (Entry Date)</label>
                        <input type="datetime-local" class="form-control" id="entryDate" readonly>
                        <small class="form-text text-muted">Sistem zamanƒ±</small>
                    </div>
                    <div class="form-group col-3">
                        <label>SRM number</label>
                        <input type="text" class="form-control" id="srmNo" readonly>
                    </div>
                    <div class="form-group col-3">
                        <label>Movement type</label>
                        <input type="text" class="form-control" id="formTransactionType" value="101 - Mal Kabul" readonly>
                    </div>
                </div>

                <!-- Invoice and Delivery Note (At least one mandatory) - Screen Designs 13 GR -->
                <div class="form-row" style="background-color: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <div class="form-group col-3">
                        <label>Invoice number <span class="required-or">*</span></label>
                        <input type="text" class="form-control" id="invoiceNumber" placeholder="Fatura numarasƒ±">
                    </div>
                    <div class="form-group col-3">
                        <label>Invoice document Date (Invoice Doc. Date)</label>
                        <input type="date" class="form-control" id="invoiceDate">
                    </div>
                    <div class="form-group col-3">
                        <label>Delivery note number <span class="required-or">*</span></label>
                        <input type="text" class="form-control" id="deliveryNoteNumber" placeholder="ƒ∞rsaliye numarasƒ±">
                    </div>
                    <div class="form-group col-3">
                        <label>Delivery note document date (Del. Note Date)</label>
                        <input type="date" class="form-control" id="deliveryNoteDate">
                    </div>
                    <div class="col-12">
                        <small class="text-warning"><strong>Not:</strong> Invoice number veya Delivery note number'dan en az biri zorunludur.</small>
                    </div>
                </div>

                <!-- PO and Material Info (from selected item - all readonly) -->
                <div class="form-row">
                    <div class="form-group col-2">
                        <label>Order number (PO Number)</label>
                        <input type="text" class="form-control" id="formPoNumber" readonly>
                    </div>
                    <div class="form-group col-1">
                        <label>Item number</label>
                        <input type="text" class="form-control" id="formItemNo" readonly>
                    </div>
                    <div class="form-group col-2">
                        <label>Material number</label>
                        <input type="text" class="form-control" id="formMaterialNo" readonly>
                    </div>
                    <div class="form-group col-4">
                        <label>Material title</label>
                        <input type="text" class="form-control" id="formMaterialTitle" readonly>
                    </div>
                    <div class="form-group col-3">
                        <label>Unit of measure (UoM)</label>
                        <input type="text" class="form-control" id="formUOM" readonly>
                    </div>
                </div>

                <!-- Supplier Info (all readonly) -->
                <div class="form-row">
                    <div class="form-group col-2">
                        <label>Supplier number (SAP)</label>
                        <input type="text" class="form-control" id="formSupplierNo" readonly>
                    </div>
                    <div class="form-group col-4">
                        <label>Supplier title</label>
                        <input type="text" class="form-control" id="formSupplierTitle" readonly>
                    </div>
                    <div class="form-group col-2">
                        <label>Supplier material number</label>
                        <input type="text" class="form-control" id="formSupplierMaterialNo" readonly>
                    </div>
                    <div class="form-group col-4">
                        <label>Supplier material title</label>
                        <input type="text" class="form-control" id="formSupplierMaterialTitle" readonly>
                    </div>
                </div>

                <!-- Quantity Information - Screen Designs 13 GR -->
                <div class="form-row" style="background-color: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <div class="form-group col-2">
                        <label>Order quantity</label>
                        <input type="number" class="form-control" id="formOrderQty" readonly>
                    </div>
                    <div class="form-group col-2">
                        <label>Open quantity</label>
                        <input type="number" class="form-control" id="formOpenQty" readonly style="font-weight: bold; color: #1565c0;">
                    </div>
                    <div class="form-group col-2">
                        <label>Delivery quantity (Receipt Qty) <span class="required">*</span></label>
                        <input type="number" class="form-control" id="receivedQty" min="0" step="0.001" required style="font-weight: bold; font-size: 16px; border: 2px solid #4caf50;">
                    </div>
                    <div class="form-group col-2">
                        <label>Unit quantity in a package (Unit in Pack)</label>
                        <input type="number" class="form-control" id="unitPerPackage" min="1" value="1">
                    </div>
                    <div class="form-group col-2">
                        <label>Unit price (Unit Price)</label>
                        <input type="text" class="form-control" id="formUnitPrice" readonly>
                    </div>
                </div>

                <!-- Cost Information - Screen Designs 13 GR -->
                <div class="form-row" style="background-color: #f3e5f5; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <div class="form-group col-3">
                        <label>Cost ID</label>
                        <input type="text" class="form-control" id="costId" readonly placeholder="Otomatik">
                    </div>
                    <div class="form-group col-3">
                        <label>Euro Unit cost</label>
                        <input type="number" class="form-control" id="euroUnitCost" step="0.01" readonly>
                    </div>
                    <div class="form-group col-3">
                        <label>TRY unit cost</label>
                        <input type="number" class="form-control" id="tryUnitCost" step="0.01" readonly>
                    </div>
                    <div class="form-group col-3">
                        <label>Cost date</label>
                        <input type="date" class="form-control" id="costDate">
                    </div>
                </div>

                <!-- Storage Location (Warehouse/Location/Bin) - Screen Designs 13 GR -->
                <div class="form-row">
                    <div class="form-group col-3">
                        <label>Storage (Storage) <span class="required">*</span></label>
                        <select class="form-control" id="warehouse" required>
                            <option value="">Se√ßiniz...</option>
                            <option value="MERKEZ">MERKEZ</option>
                            <option value="HAT1">HAT1</option>
                            <option value="HAT2">HAT2</option>
                        </select>
                    </div>
                    <div class="form-group col-3">
                        <label>Location (Location) <span class="required">*</span></label>
                        <select class="form-control" id="location" required>
                            <option value="">Se√ßiniz...</option>
                            <option value="Alt Bin">Alt Bin</option>
                            <option value="Ust Bin">Ust Bin</option>
                            <option value="Kimyasal">Kimyasal</option>
                            <option value="Agir Parca">Agir Parca</option>
                        </select>
                    </div>
                    <div class="form-group col-3">
                        <label>Bin (Bin) <span class="required">*</span></label>
                        <input type="text" class="form-control" id="bin" placeholder="A01-R02-K05" required>
                    </div>
                    <div class="form-group col-3">
                        <label>&nbsp;</label>
                        <div class="form-check" style="margin-top: 10px;">
                            <input type="checkbox" class="form-check-input" id="orderClosed">
                            <label class="form-check-label" for="orderClosed">
                                <strong>Sipari≈üi Kapat</strong> (Eksik teslimat)
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Stock Record IDs - Screen Designs 13 GR (section b) -->
                <div class="form-row">
                    <div class="form-group col-3">
                        <label>Stock Kayƒ±t ID (Stock Record Id)</label>
                        <input type="text" class="form-control" id="stockRecordId" readonly placeholder="Otomatik">
                        <small class="form-text text-muted">Sistem olu≈üturur</small>
                    </div>
                    <div class="form-group col-3">
                        <label>√ñnceki Stock Kayƒ±t ID (Prev. Stock Rec.)</label>
                        <input type="text" class="form-control" id="prevStockRecordId" readonly>
                        <small class="form-text text-muted">Rollback i√ßin</small>
                    </div>
                    <div class="form-group col-6">
                        <label>Notes</label>
                        <textarea class="form-control" id="receiptNotes" rows="2" placeholder="Mal kabul ile ilgili notlar..."></textarea>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="form-actions" style="margin-top: 20px;">
                    <button class="btn btn-primary btn-lg" id="saveReceiptBtn">
                        ‚úì Mal Kabul Yap
                    </button>
                    <button class="btn btn-secondary" id="printLabelBtn">
                        üè∑Ô∏è Etiket Yazdƒ±r
                    </button>
                    <button class="btn btn-outline" id="cancelReceiptBtn">
                        ƒ∞ptal
                    </button>
                </div>
            </div>
        </div>

        <!-- ============================================
             SECTION 3: ROLLBACK FORM - For Transaction Type 102
             ============================================ -->
        <div class="card" id="rollbackFormSection" style="display: none;">
            <div class="card-header">
                <h3>Mal Kabul ƒ∞ptal (Rollback) Formu</h3>
                <div class="card-header-actions">
                    <button class="btn btn-outline btn-sm" id="closeRollbackBtn">‚úï Kapat</button>
                </div>
            </div>
            <div class="card-body">

                <div class="form-row">
                    <div class="form-group col-4">
                        <label>ƒ∞ptal Edilecek GR No <span class="required">*</span></label>
                        <input type="text" class="form-control" id="rollbackGrNo" placeholder="GR-2025-000XXX">
                    </div>
                    <div class="form-group col-4">
                        <label>&nbsp;</label>
                        <button class="btn btn-primary btn-block" id="searchGrBtn">üîç GR Bul</button>
                    </div>
                </div>

                <!-- GR Details (populated after search) -->
                <div id="rollbackGrDetails" style="display: none;">
                    <div class="form-row">
                        <div class="form-group col-3">
                            <label>√ñnceki GR ID</label>
                            <input type="text" class="form-control" id="prevGrId" readonly>
                        </div>
                        <div class="form-group col-3">
                            <label>√ñnceki Stock Kayƒ±t ID</label>
                            <input type="text" class="form-control" id="prevStockRecordId" readonly>
                        </div>
                        <div class="form-group col-3">
                            <label>Order number</label>
                            <input type="text" class="form-control" id="rollbackPoNo" readonly>
                        </div>
                        <div class="form-group col-3">
                            <label>Material number</label>
                            <input type="text" class="form-control" id="rollbackMaterialNo" readonly>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-3">
                            <label>Kabul Edilen Miktar</label>
                            <input type="number" class="form-control" id="rollbackQty" readonly>
                        </div>
                        <div class="form-group col-3">
                            <label>Unit of measure</label>
                            <input type="text" class="form-control" id="rollbackUom" readonly>
                        </div>
                        <div class="form-group col-6">
                            <label>ƒ∞ptal Nedeni <span class="required">*</span></label>
                            <textarea class="form-control" id="rollbackReason" rows="2" placeholder="ƒ∞ptal nedenini a√ßƒ±klayƒ±n..." required></textarea>
                        </div>
                    </div>

                    <div class="form-actions" style="margin-top: 20px;">
                        <button class="btn btn-danger btn-lg" id="executeRollbackBtn">
                            ‚ö†Ô∏è ƒ∞ptal Actionini Uygula
                        </button>
                        <button class="btn btn-outline" id="cancelRollbackBtn">
                            Vazge√ß
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================
             SECTION 4: RETURN FORM - For Transaction Type 122/161
             ============================================ -->
        <div class="card" id="returnFormSection" style="display: none;">
            <div class="card-header">
                <h3 id="returnFormTitle">ƒ∞ade Formu</h3>
                <div class="card-header-actions">
                    <button class="btn btn-outline btn-sm" id="closeReturnBtn">‚úï Kapat</button>
                </div>
            </div>
            <div class="card-body">
                <!-- Step 1: GR Se√ßimi -->

                <div class="form-row" style="background-color: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div class="form-group col-3">
                        <label>ƒ∞ade No</label>
                        <input type="text" class="form-control" id="returnId" readonly style="background-color: #ffebee; font-weight: bold;">
                        <small class="form-text text-muted">Sistem otomatik olu≈üturur</small>
                    </div>
                    <div class="form-group col-3">
                        <label>ƒ∞ade Datei <span class="required">*</span></label>
                        <input type="date" class="form-control" id="returnDate" required>
                    </div>
                    <div class="form-group col-6">
                        <label>Orijinal GR Kaydƒ± <span class="required">*</span></label>
                        <select class="form-control" id="originalGrNo" style="font-size: 13px; font-weight: bold;">
                            <option value="">-- GR Se√ßiniz --</option>
                        </select>
                        <small class="form-text text-muted">Listeden bir GR se√ßin - se√ßim yapƒ±ldƒ±ƒüƒ±nda detaylar otomatik y√ºklenir</small>
                    </div>
                </div>

                <!-- Step 2-6: Original GR Details (Hidden until GR found) -->
                <div id="returnGrDetails" style="display: none;">

                    <!-- GR Header Info (readonly) -->
                    <div class="form-row" style="background-color: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <div class="form-group col-3">
                            <label>Orijinal GR ID</label>
                            <input type="text" class="form-control" id="returnOriginalGrId" readonly>
                        </div>
                        <div class="form-group col-3">
                            <label>Orijinal GR Datei</label>
                            <input type="text" class="form-control" id="returnOriginalGrDate" readonly>
                        </div>
                        <div class="form-group col-3">
                            <label>Order number (PO)</label>
                            <input type="text" class="form-control" id="returnPoNo" readonly>
                        </div>
                        <div class="form-group col-3">
                            <label>Item number No</label>
                            <input type="text" class="form-control" id="returnItemNo" readonly>
                        </div>
                    </div>

                    <!-- Material Info (readonly) -->
                    <div class="form-row">
                        <div class="form-group col-3">
                            <label>Material number</label>
                            <input type="text" class="form-control" id="returnMaterialNo" readonly>
                        </div>
                        <div class="form-group col-5">
                            <label>Material title</label>
                            <input type="text" class="form-control" id="returnMaterialTitle" readonly>
                        </div>
                        <div class="form-group col-4">
                            <label>Tedarik√ßi</label>
                            <input type="text" class="form-control" id="returnSupplier" readonly>
                        </div>
                    </div>

                    <!-- Quantity Info -->
                    <div class="form-row" style="background-color: #f3e5f5; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <div class="form-group col-2">
                            <label>GR Kabul Mik.</label>
                            <input type="number" class="form-control" id="returnGrQty" readonly style="font-weight: bold;">
                            <small class="form-text text-muted">Orijinal kabul</small>
                        </div>
                        <div class="form-group col-2">
                            <label>Available quantity</label>
                            <input type="number" class="form-control" id="returnCurrentStock" readonly style="background-color: #e8f5e9; font-weight: bold;">
                        </div>
                        <div class="form-group col-2">
                            <label>ƒ∞ade Miktarƒ± <span class="required">*</span></label>
                            <input type="number" class="form-control" id="returnQty" min="0.01" step="0.01" required style="font-size: 16px; border: 2px solid #ff9800; font-weight: bold;">
                        </div>
                        <div class="form-group col-2">
                            <label>Unit of measure</label>
                            <input type="text" class="form-control" id="returnUom" readonly>
                        </div>
                        <div class="form-group col-2">
                            <label>EUR Unit price</label>
                            <input type="text" class="form-control" id="returnEurPrice" readonly>
                        </div>
                        <div class="form-group col-2">
                            <label>ƒ∞ade Tutarƒ± (EUR)</label>
                            <input type="text" class="form-control" id="returnTotalEur" readonly style="background-color: #ffebee; font-weight: bold;">
                        </div>
                    </div>

                    <!-- Location Info (readonly from original GR) -->
                    <div class="form-row">
                        <div class="form-group col-3">
                            <label>Storage</label>
                            <input type="text" class="form-control" id="returnWarehouse" readonly>
                        </div>
                        <div class="form-group col-3">
                            <label>Location</label>
                            <input type="text" class="form-control" id="returnLocation" readonly>
                        </div>
                        <div class="form-group col-3">
                            <label>Bin</label>
                            <input type="text" class="form-control" id="returnBin" readonly>
                        </div>
                        <div class="form-group col-3">
                            <label>Stock Kayƒ±t ID</label>
                            <input type="text" class="form-control" id="returnStockRecordId" readonly>
                        </div>
                    </div>

                    <!-- Return Reason -->
                    <div class="form-row" style="background-color: #fff8e1; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <div class="form-group col-4">
                            <label>ƒ∞ade Nedeni <span class="required">*</span></label>
                            <select class="form-control" id="returnReasonType" required style="font-weight: bold;">
                                <option value="">Se√ßiniz...</option>
                                <option value="DEFECTIVE">Arƒ±zalƒ±/Hatalƒ± Malzeme</option>
                                <option value="WRONG_MATERIAL">Yanlƒ±≈ü Malzeme</option>
                                <option value="OVER_DELIVERY">Fazla Teslimat</option>
                                <option value="QUALITY_ISSUE">Kalite Sorunu</option>
                                <option value="PACKING_RETURN">Ambalaj ƒ∞adesi</option>
                                <option value="OTHER">Diƒüer</option>
                            </select>
                        </div>
                        <div class="form-group col-8">
                            <label>ƒ∞ade Descriptionsƒ±</label>
                            <textarea class="form-control" id="returnDescription" rows="2" placeholder="ƒ∞ade ile ilgili detaylƒ± a√ßƒ±klama..."></textarea>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="form-actions" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                        <button class="btn btn-warning btn-lg" id="executeReturnBtn">
                            ‚Ü©Ô∏è ƒ∞ade Actionini Uygula
                        </button>
                        <button class="btn btn-outline" id="cancelReturnBtn">
                            Vazge√ß
                        </button>
                    </div>
                </div>

                <!-- No GR Found Message -->
                <div id="returnGrNotFound" style="display: none;">
                </div>
            </div>
        </div>

        <!-- ============================================
             SECTION 5: MULTIPLE ITEMS RECEIPT TABLE
             ============================================ -->
        <div class="card" id="multipleItemsSection" style="display: none;">
            <div class="card-header">
                <h3>Toplu Mal Kabul - Se√ßilen Kalemler</h3>
                <div class="card-header-actions">
                    <span class="status-badge status-warning" id="selectedItemsCount">0 Kalem Se√ßili</span>
                </div>
            </div>
            <div class="card-body">
                <!-- Scrollable Table Container -->
                <div class="table-responsive-wrapper">
                    <table class="table batch-receipt-table">
                        <thead>
                            <tr>
                                <th class="sticky-col col-po">Order number</th>
                                <th class="col-item">Item number</th>
                                <th class="col-material">Material number</th>
                                <th class="col-material-name">Material title</th>
                                <th class="col-qty">Open quantity</th>
                                <th class="col-qty-input">Delivery quantity</th>
                                <th class="col-unit">Unit of measure</th>
                                <th class="col-pack">Unit quantity in a package</th>
                                <th class="col-label">Label Quantity</th>
                                <th class="col-price">Euro Unit cost</th>
                                <th class="col-price">TRY Unit cost</th>
                                <th class="col-location">Storage</th>
                                <th class="col-location">Location</th>
                                <th class="col-location">Bin</th>
                                <th class="col-close">Kapat</th>
                            </tr>
                        </thead>
                        <tbody id="multipleItemsTable">
                            <!-- Dynamically populated -->
                        </tbody>
                    </table>
                </div>

                <!-- Scroll Indicator -->
                <div class="scroll-indicator">
                    <span>‚Üê Kaydƒ±rƒ±n ‚Üí</span>
                </div>

                <!-- Common fields for batch receipt -->
                <div class="form-row" style="background-color: #fff3e0; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <div class="form-group col-3">
                        <label>Invoice number <span class="required-or">*</span></label>
                        <input type="text" class="form-control" id="batchInvoiceNumber">
                    </div>
                    <div class="form-group col-3">
                        <label>Invoice document Date</label>
                        <input type="date" class="form-control" id="batchInvoiceDate">
                    </div>
                    <div class="form-group col-3">
                        <label>Delivery note number <span class="required-or">*</span></label>
                        <input type="text" class="form-control" id="batchDeliveryNoteNumber">
                    </div>
                    <div class="form-group col-3">
                        <label>Delivery note document date</label>
                        <input type="date" class="form-control" id="batchDeliveryNoteDate">
                    </div>
                </div>

                <div class="form-actions" style="margin-top: 20px;">
                    <button class="btn btn-primary btn-lg" id="saveBatchReceiptBtn">
                        ‚úì Toplu Mal Kabul Yap
                    </button>
                    <button class="btn btn-secondary" id="printBatchLabelsBtn">
                        üè∑Ô∏è T√ºm Etiketleri Yazdƒ±r
                    </button>
                    <button class="btn btn-outline" id="cancelBatchReceiptBtn">
                        ƒ∞ptal
                    </button>
                </div>
            </div>
        </div>

        <!-- Developer Notes -->

    </main>

    <style>
        .required { color: #dc3545; font-weight: bold; }
        .required-or { color: #ff9800; font-weight: bold; }
        .form-control[readonly] { background-color: #f5f5f5; }
        .form-control:disabled { background-color: #f5f5f5; cursor: not-allowed; }
        .text-warning { color: #ff9800; }
        .text-info { color: #2196f3; }
        .form-check { display: flex; align-items: center; }
        .form-check-input { margin-right: 8px; width: 18px; height: 18px; }
        .item-exclude:checked + td,
        tr:has(.item-exclude:checked) {
            opacity: 0.5;
            text-decoration: line-through;
        }

        /* ========================================
           BATCH RECEIPT TABLE RESPONSIVE STYLES
           ======================================== */
        .table-responsive-wrapper {
            overflow-x: auto;
            overflow-y: visible;
            max-width: 100%;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fff;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
        }

        .table-responsive-wrapper::-webkit-scrollbar {
            height: 10px;
        }

        .table-responsive-wrapper::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }

        .table-responsive-wrapper::-webkit-scrollbar-thumb {
            background: #007bff;
            border-radius: 5px;
        }

        .table-responsive-wrapper::-webkit-scrollbar-thumb:hover {
            background: #0056b3;
        }

        .batch-receipt-table {
            min-width: 1400px;
            font-size: 12px;
            border-collapse: separate;
            border-spacing: 0;
            margin: 0;
        }

        .batch-receipt-table thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .batch-receipt-table th {
            background: linear-gradient(135deg, #1976d2, #1565c0);
            color: white;
            font-weight: 600;
            padding: 12px 8px;
            text-align: center;
            white-space: nowrap;
            border-bottom: 2px solid #0d47a1;
            position: sticky;
            top: 0;
        }

        .batch-receipt-table td {
            padding: 10px 8px;
            text-align: center;
            vertical-align: middle;
            border-bottom: 1px solid #e0e0e0;
            background: #fff;
        }

        .batch-receipt-table tbody tr:hover td {
            background: #e3f2fd;
        }

        .batch-receipt-table tbody tr:nth-child(even) td {
            background: #fafafa;
        }

        .batch-receipt-table tbody tr:nth-child(even):hover td {
            background: #e3f2fd;
        }

        /* Sticky First Column */
        .batch-receipt-table .sticky-col {
            position: sticky;
            left: 0;
            z-index: 5;
            background: linear-gradient(135deg, #1976d2, #1565c0) !important;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }

        .batch-receipt-table td:first-child {
            position: sticky;
            left: 0;
            z-index: 4;
            background: #fff;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            font-weight: 600;
            color: #1976d2;
        }

        .batch-receipt-table tbody tr:hover td:first-child {
            background: #e3f2fd;
        }

        .batch-receipt-table tbody tr:nth-child(even) td:first-child {
            background: #fafafa;
        }

        .batch-receipt-table tbody tr:nth-child(even):hover td:first-child {
            background: #e3f2fd;
        }

        /* Column Widths */
        .col-po { min-width: 110px; }
        .col-item { min-width: 60px; }
        .col-material { min-width: 130px; }
        .col-material-name { min-width: 180px; text-align: left !important; }
        .col-qty { min-width: 80px; }
        .col-qty-input { min-width: 100px; }
        .col-unit { min-width: 60px; }
        .col-pack { min-width: 90px; }
        .col-label { min-width: 90px; }
        .col-price { min-width: 100px; }
        .col-location { min-width: 100px; }
        .col-close { min-width: 80px; }

        /* Input Styling in Table */
        .batch-receipt-table input[type="number"] {
            width: 80px;
            padding: 6px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 12px;
            text-align: center;
        }

        .batch-receipt-table input[type="number"]:focus {
            border-color: #1976d2;
            outline: none;
            box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
        }

        .batch-receipt-table select {
            width: 100%;
            padding: 6px 4px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 11px;
            background: #fff;
        }

        .batch-receipt-table select:focus {
            border-color: #1976d2;
            outline: none;
            box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
        }

        .batch-receipt-table input[type="text"] {
            width: 90px;
            padding: 6px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 11px;
        }

        .batch-receipt-table input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Scroll Indicator */
        .scroll-indicator {
            text-align: center;
            padding: 8px;
            background: linear-gradient(90deg, transparent, #e3f2fd, transparent);
            color: #1976d2;
            font-size: 12px;
            font-weight: 500;
            animation: pulse 2s infinite;
            transition: opacity 0.3s ease;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* Left align material columns */
        .batch-receipt-table td:nth-child(3),
        .batch-receipt-table td:nth-child(4) {
            text-align: left;
        }

        /* Material name wrapping */
        .batch-receipt-table td:nth-child(4) {
            max-width: 200px;
            white-space: normal;
            word-wrap: break-word;
        }
    </style>

    <script>
        // Mock data for open PO items
        const mockOpenItems = [
            {
                id: 1,
                poNumber: '4500012345',
                itemNo: '10',
                materialNo: '01.00002-0001',
                materialTitle: 'Rulman 6205-2RS SKF',
                supplierMaterialNo: 'SKF-6205-2RS',
                supplierMaterialTitle: 'Rulman 6205 2RS',
                supplierNo: '1000045678',
                supplierTitle: 'ABC End√ºstriyel Malzeme A.≈û.',
                uom: 'AD',
                orderQty: 100,
                openQty: 100,
                unitPrice: 125.50,
                currency: 'EUR',
                srmNo: 'SRM-2025-001234'
            },
            {
                id: 2,
                poNumber: '4500012345',
                itemNo: '20',
                materialNo: '01.00015-0003',
                materialTitle: 'Hidrolik Yag ISO 46',
                supplierMaterialNo: 'HYD-ISO46-200',
                supplierMaterialTitle: 'Hidrolik Yag ISO 46',
                supplierNo: '1000045678',
                supplierTitle: 'ABC End√ºstriyel Malzeme A.≈û.',
                uom: 'LT',
                orderQty: 200,
                openQty: 200,
                unitPrice: 45.00,
                currency: 'EUR',
                srmNo: 'SRM-2025-001234'
            },
            {
                id: 3,
                poNumber: '4500012346',
                itemNo: '10',
                materialNo: '01.00028-0001',
                materialTitle: 'Elektrik Motoru 5.5kW',
                supplierMaterialNo: 'MOT-5500W-380',
                supplierMaterialTitle: 'Electric Motor 5.5kW',
                supplierNo: '1000045679',
                supplierTitle: 'XYZ Elektrik San. Tic. Ltd.',
                uom: 'AD',
                orderQty: 5,
                openQty: 5,
                unitPrice: 1850.00,
                currency: 'EUR',
                srmNo: 'SRM-2025-001456'
            }
        ];

        // Mock GR history for rollback/return - Extended with full details
        const mockGrHistory = {
            'GR-2025-000001': {
                grId: 'GR-2025-000001',
                grDate: '10.12.2025',
                poNumber: '4500012340',
                itemNo: '10',
                materialNo: '01.00002-0001',
                materialTitle: 'Rulman 6205-2RS SKF',
                supplierNo: '1000045678',
                supplierTitle: 'ABC End√ºstriyel Malzeme A.≈û.',
                grQty: 50,
                currentStock: 45,
                uom: 'AD',
                eurPrice: 125.50,
                warehouse: 'MERKEZ',
                location: 'Alt Bin',
                bin: 'A01-R02-K05',
                stockRecordId: 'STK-2025-000001'
            },
            'GR-2025-000002': {
                grId: 'GR-2025-000002',
                grDate: '12.12.2025',
                poNumber: '4500012341',
                itemNo: '20',
                materialNo: '01.00015-0003',
                materialTitle: 'Hidrolik Yag ISO 46',
                supplierNo: '1000045678',
                supplierTitle: 'ABC End√ºstriyel Malzeme A.≈û.',
                grQty: 100,
                currentStock: 85,
                uom: 'LT',
                eurPrice: 45.00,
                warehouse: 'MERKEZ',
                location: 'Kimyasal',
                bin: 'K01-R01-K01',
                stockRecordId: 'STK-2025-000002'
            },
            'GR-2025-000003': {
                grId: 'GR-2025-000003',
                grDate: '14.12.2025',
                poNumber: '4500012346',
                itemNo: '10',
                materialNo: '01.00028-0001',
                materialTitle: 'Elektrik Motoru 5.5kW',
                supplierNo: '1000045679',
                supplierTitle: 'XYZ Elektrik San. Tic. Ltd.',
                grQty: 5,
                currentStock: 5,
                uom: 'AD',
                eurPrice: 1850.00,
                warehouse: 'HAT1',
                location: 'Agir Parca',
                bin: 'H01-R03-K01',
                stockRecordId: 'STK-2025-000003'
            },
            'GR-2025-000004': {
                grId: 'GR-2025-000004',
                grDate: '15.12.2025',
                poNumber: '4500012350',
                itemNo: '10',
                materialNo: '01.00050-0001',
                materialTitle: 'Ambalaj Kutusu 40x30x20',
                supplierNo: '1000045680',
                supplierTitle: 'Ambalaj Sanayi A.≈û.',
                grQty: 500,
                currentStock: 480,
                uom: 'AD',
                eurPrice: 2.50,
                warehouse: 'MERKEZ',
                location: 'Alt Bin',
                bin: 'A05-R01-K01',
                stockRecordId: 'STK-2025-000004',
                isPacking: true
            }
        };

        let selectedItems = [];
        let currentExchangeRate = 38.50; // Default EUR/TRY

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
        });

        function initializePage() {
            // Set default dates - Screen Designs 13 GR
            const now = new Date();
            const today = now.toISOString().split('T')[0];

            // Entry date is system timestamp (readonly)
            document.getElementById('entryDate').value = now.toISOString().slice(0, 16);
            document.getElementById('costDate').value = today;
            document.getElementById('returnDate').value = today;

            // Generate GR ID - system auto-generated
            document.getElementById('grId').value = 'GR-2025-' + String(Math.floor(Math.random() * 1000000)).padStart(6, '0');
            document.getElementById('returnId').value = 'RET-2025-' + String(Math.floor(Math.random() * 1000000)).padStart(6, '0');

            setupEventListeners();
        }

        function setupEventListeners() {
            // Transaction type change
            document.getElementById('transactionType').addEventListener('change', handleTransactionTypeChange);

            // Search functionality
            document.getElementById('searchBtn').addEventListener('click', applyFilters);
            document.getElementById('clearFilterBtn').addEventListener('click', clearFilters);

            // Enter tu≈üu ile arama yapma
            const filterInputs = [
                'searchBox', 'filterOrderNo', 'filterItemNo', 'filterMaterialNo',
                'filterMaterialTitle', 'filterSupplierNo', 'filterSupplierTitle'
            ];
            filterInputs.forEach(inputId => {
                document.getElementById(inputId).addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        applyFilters();
                    }
                });
            });

            // Unit of measure se√ßimi deƒüi≈ütiƒüinde otomatik filtrele
            document.getElementById('filterUOM').addEventListener('change', applyFilters);

            // Select all checkbox
            document.getElementById('selectAllItems').addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('.item-select');
                checkboxes.forEach(cb => {
                    cb.checked = this.checked;
                });
                updateSelectedItems();
            });

            // Individual item selection
            document.querySelectorAll('.item-select').forEach(cb => {
                cb.addEventListener('change', updateSelectedItems);
            });

            // Exclude checkboxes
            document.querySelectorAll('.item-exclude').forEach(cb => {
                cb.addEventListener('change', function() {
                    const row = this.closest('tr');
                    if (this.checked) {
                        row.style.opacity = '0.5';
                        row.style.textDecoration = 'line-through';
                        row.querySelector('.item-select').checked = false;
                        row.querySelector('.item-select').disabled = true;
                    } else {
                        row.style.opacity = '1';
                        row.style.textDecoration = 'none';
                        row.querySelector('.item-select').disabled = false;
                    }
                    updateSelectedItems();
                });
            });

            // Row click selection
            document.querySelectorAll('.table-row-clickable').forEach(row => {
                row.addEventListener('click', function(e) {
                    if (e.target.type !== 'checkbox') {
                        const cb = this.querySelector('.item-select');
                        if (!cb.disabled) {
                            cb.checked = !cb.checked;
                            updateSelectedItems();
                        }
                    }
                });
            });

            // Cost and quantity calculations - Screen Designs 13 GR
            document.getElementById('receivedQty').addEventListener('input', function() {
                calculateCosts();
                calculateLabelQty();
            });
            document.getElementById('unitPerPackage').addEventListener('input', calculateLabelQty);

            // Form buttons
            document.getElementById('closeFormBtn').addEventListener('click', closeReceiptForm);
            document.getElementById('saveReceiptBtn').addEventListener('click', saveReceipt);
            document.getElementById('printLabelBtn').addEventListener('click', printLabels);
            document.getElementById('cancelReceiptBtn').addEventListener('click', cancelReceipt);

            // Rollback buttons
            document.getElementById('closeRollbackBtn').addEventListener('click', closeRollbackForm);
            document.getElementById('searchGrBtn').addEventListener('click', searchGrForRollback);
            document.getElementById('executeRollbackBtn').addEventListener('click', executeRollback);
            document.getElementById('cancelRollbackBtn').addEventListener('click', closeRollbackForm);

            // Return buttons
            document.getElementById('closeReturnBtn').addEventListener('click', closeReturnForm);
            document.getElementById('executeReturnBtn').addEventListener('click', executeReturn);
            document.getElementById('cancelReturnBtn').addEventListener('click', closeReturnForm);

            // Return GR dropdown change - auto load details
            document.getElementById('originalGrNo').addEventListener('change', function() {
                if (this.value) {
                    loadGrDetailsForReturn(this.value);
                } else {
                    document.getElementById('returnGrDetails').style.display = 'none';
                    document.getElementById('returnGrNotFound').style.display = 'none';
                }
            });

            // Return quantity change - calculate total
            document.getElementById('returnQty').addEventListener('input', calculateReturnTotal);

            // Batch buttons
            document.getElementById('saveBatchReceiptBtn').addEventListener('click', saveBatchReceipt);
            document.getElementById('printBatchLabelsBtn').addEventListener('click', printBatchLabels);
            document.getElementById('cancelBatchReceiptBtn').addEventListener('click', cancelBatchReceipt);

            // Header buttons
            document.getElementById('grHistoryBtn').addEventListener('click', function() {
                alert('üìã Mal Kabul Ge√ßmi≈üi sayfasƒ±na y√∂nlendirilecek.\n\n(gr-history.html)');
            });
            document.getElementById('returnMaterialBtn').addEventListener('click', function() {
                document.getElementById('transactionType').value = '122';
                handleTransactionTypeChange();
            });
            document.getElementById('returnPackingBtn').addEventListener('click', function() {
                document.getElementById('transactionType').value = '161';
                handleTransactionTypeChange();
            });
        }

        // Handle transaction type change
        function handleTransactionTypeChange() {
            const type = document.getElementById('transactionType').value;
            const typeDescriptions = {
                '101': 'Standart Mal Kabul',
                '102': 'Mal Kabul ƒ∞ptal (Rollback)',
                '122': 'Malzeme ƒ∞ade (Tedarik√ßiye)',
                '161': 'Satƒ±n Alƒ±nan Ambalaj ƒ∞ade'
            };

            document.getElementById('transactionTypeTitle').value = typeDescriptions[type] || '';

            // Hide all form sections
            document.getElementById('openOrdersSection').style.display = 'none';
            document.getElementById('openItemsListCard').style.display = 'none';
            document.getElementById('receiptFormSection').style.display = 'none';
            document.getElementById('rollbackFormSection').style.display = 'none';
            document.getElementById('returnFormSection').style.display = 'none';
            document.getElementById('multipleItemsSection').style.display = 'none';

            switch(type) {
                case '101':
                    // Standard GR - show open orders and list
                    document.getElementById('openOrdersSection').style.display = 'block';
                    document.getElementById('openItemsListCard').style.display = 'block';
                    break;
                case '102':
                    // Rollback - show rollback form
                    document.getElementById('rollbackFormSection').style.display = 'block';
                    break;
                case '122':
                    // Material Return
                    document.getElementById('returnFormTitle').textContent = 'Malzeme ƒ∞ade Formu';
                    document.getElementById('returnFormSection').style.display = 'block';
                    populateGrDropdown(false); // false = material only (not packing)
                    break;
                case '161':
                    // Packing Material Return
                    document.getElementById('returnFormTitle').textContent = 'Ambalaj ƒ∞ade Formu';
                    document.getElementById('returnFormSection').style.display = 'block';
                    populateGrDropdown(true); // true = packing only
                    break;
                default:
                    // Show default sections
                    document.getElementById('openOrdersSection').style.display = 'block';
                    document.getElementById('openItemsListCard').style.display = 'block';
            }
        }

        // Populate GR dropdown based on transaction type
        function populateGrDropdown(packingOnly) {
            const dropdown = document.getElementById('originalGrNo');
            dropdown.innerHTML = '<option value="">-- GR Se√ßiniz --</option>';

            // Filter GR records
            Object.values(mockGrHistory).forEach(gr => {
                // For packing (161), show only packing GRs
                // For material (122), show only non-packing GRs
                if (packingOnly && !gr.isPacking) return;
                if (!packingOnly && gr.isPacking) return;

                const option = document.createElement('option');
                option.value = gr.grId;
                option.textContent = `${gr.grId} | ${gr.materialNo} - ${gr.materialTitle} | Stock: ${gr.currentStock} ${gr.uom}`;
                dropdown.appendChild(option);
            });

            // Reset form state
            document.getElementById('returnGrDetails').style.display = 'none';
            document.getElementById('returnGrNotFound').style.display = 'none';
        }

        // Update selected items
        function updateSelectedItems() {
            const checkboxes = document.querySelectorAll('.item-select:checked');
            selectedItems = [];

            checkboxes.forEach(cb => {
                const itemId = parseInt(cb.value);
                const item = mockOpenItems.find(i => i.id === itemId);
                if (item) {
                    selectedItems.push(item);
                }
            });

            document.getElementById('selectedItemsCount').textContent = selectedItems.length + ' Kalem Se√ßili';

            if (selectedItems.length === 0) {
                document.getElementById('receiptFormSection').style.display = 'none';
                document.getElementById('multipleItemsSection').style.display = 'none';
            } else if (selectedItems.length === 1) {
                // Single item - show regular form
                document.getElementById('multipleItemsSection').style.display = 'none';
                showReceiptForm(selectedItems[0]);
            } else {
                // Multiple items - show batch form
                document.getElementById('receiptFormSection').style.display = 'none';
                showMultipleItemsForm();
            }
        }

        // Show receipt form for single item
        function showReceiptForm(item) {
            document.getElementById('receiptFormSection').style.display = 'block';
            document.getElementById('receiptFormSection').scrollIntoView({ behavior: 'smooth', block: 'start' });

            // Set Entry Date to current datetime (readonly - system timestamp)
            const now = new Date();
            document.getElementById('entryDate').value = now.toISOString().slice(0, 16);

            // Populate readonly fields from selected PO item
            document.getElementById('srmNo').value = item.srmNo;
            document.getElementById('formPoNumber').value = item.poNumber;
            document.getElementById('formItemNo').value = item.itemNo;
            document.getElementById('formMaterialNo').value = item.materialNo;
            document.getElementById('formMaterialTitle').value = item.materialTitle;
            document.getElementById('formUOM').value = item.uom;
            document.getElementById('formSupplierNo').value = item.supplierNo;
            document.getElementById('formSupplierTitle').value = item.supplierTitle;
            document.getElementById('formSupplierMaterialNo').value = item.supplierMaterialNo;
            document.getElementById('formSupplierMaterialTitle').value = item.supplierMaterialTitle;
            document.getElementById('formOrderQty').value = item.orderQty;
            document.getElementById('formOpenQty').value = item.openQty;
            document.getElementById('formUnitPrice').value = item.unitPrice.toFixed(2) + ' ' + item.currency;
            document.getElementById('euroUnitCost').value = item.unitPrice;

            // Pre-fill receipt quantity with open quantity
            document.getElementById('receivedQty').value = item.openQty;

            // Set cost date to today
            document.getElementById('costDate').value = new Date().toISOString().split('T')[0];

            // Clear editable location fields
            document.getElementById('warehouse').value = '';
            document.getElementById('location').value = '';
            document.getElementById('bin').value = '';
            document.getElementById('receiptNotes').value = '';
            document.getElementById('orderClosed').checked = false;

            // Clear document fields
            document.getElementById('invoiceNumber').value = '';
            document.getElementById('invoiceDate').value = '';
            document.getElementById('deliveryNoteNumber').value = '';
            document.getElementById('deliveryNoteDate').value = '';

            // Calculate costs and label quantity
            calculateCosts();
            calculateLabelQty();
        }

        // Show multiple items form
        function showMultipleItemsForm() {
            document.getElementById('multipleItemsSection').style.display = 'block';
            document.getElementById('multipleItemsSection').scrollIntoView({ behavior: 'smooth', block: 'start' });

            // Reset scroll indicator visibility
            const scrollIndicator = document.querySelector('.scroll-indicator');
            if (scrollIndicator) {
                scrollIndicator.style.display = 'block';
                scrollIndicator.style.opacity = '1';
            }

            // Re-attach scroll event listener to hide indicator after scroll
            const tableWrapper = document.querySelector('.table-responsive-wrapper');
            if (tableWrapper && scrollIndicator) {
                const hideIndicator = function() {
                    scrollIndicator.style.opacity = '0';
                    setTimeout(() => {
                        scrollIndicator.style.display = 'none';
                    }, 300);
                    tableWrapper.removeEventListener('scroll', hideIndicator);
                };
                tableWrapper.addEventListener('scroll', hideIndicator);
            }

            const tbody = document.getElementById('multipleItemsTable');
            tbody.innerHTML = '';

            selectedItems.forEach((item, index) => {
                const row = document.createElement('tr');
                // Calculate initial label qty (default unit per package = 1)
                row.innerHTML = `
                    <td>${item.poNumber}</td>
                    <td>${item.itemNo}</td>
                    <td>${item.materialNo}</td>
                    <td>${item.materialTitle}</td>
                    <td>${item.openQty}</td>
                    <td><input type="number" class="form-control batch-qty" data-index="${index}" value="${item.openQty}" min="0" step="0.01"></td>
                    <td>${item.uom}</td>
                    <td><input type="number" class="form-control batch-unit-pack" data-index="${index}" value="1" min="1" step="1"></td>
                    <td>${item.unitPrice.toFixed(2)}</td>
                    <td class="batch-try-cost">${(item.unitPrice * currentExchangeRate).toFixed(2)}</td>
                    <td>
                        <select class="form-control batch-warehouse" data-index="${index}">
                            <option value="">...</option>
                            <option value="MERKEZ">MERKEZ</option>
                            <option value="HAT1">HAT1</option>
                            <option value="HAT2">HAT2</option>
                        </select>
                    </td>
                    <td>
                        <select class="form-control batch-location" data-index="${index}">
                            <option value="">...</option>
                            <option value="Alt Bin">Alt Bin</option>
                            <option value="Ust Bin">Ust Bin</option>
                            <option value="Kimyasal">Kimyasal</option>
                        </select>
                    </td>
                    <td><input type="text" class="form-control batch-bin" data-index="${index}" placeholder="A01-R02"></td>
                    <td><input type="checkbox" class="batch-close" data-index="${index}"></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Calculate costs - TRY = EUR √ó Exchange Rate (from SAP_ExchangeRate table)
        function calculateCosts() {
            const qty = parseFloat(document.getElementById('receivedQty').value) || 0;
            const euroPrice = parseFloat(document.getElementById('euroUnitCost').value) || 0;
            // Exchange rate comes from system (SAP_ExchangeRate table)
            const rate = currentExchangeRate;

            const tryPrice = euroPrice * rate;

            document.getElementById('tryUnitCost').value = tryPrice.toFixed(2);
        }

        // Validate receipt form - Screen Designs 13 GR
        function validateReceiptForm() {
            const invoiceNo = document.getElementById('invoiceNumber').value.trim();
            const deliveryNo = document.getElementById('deliveryNoteNumber').value.trim();
            const receivedQty = parseFloat(document.getElementById('receivedQty').value);
            const warehouse = document.getElementById('warehouse').value;
            const location = document.getElementById('location').value;
            const bin = document.getElementById('bin').value;
            const notes = document.getElementById('receiptNotes').value;

            // At least one of invoice or delivery note required
            if (!invoiceNo && !deliveryNo) {
                alert('‚ö†Ô∏è Invoice number veya Delivery note number\'dan en az biri zorunludur.');
                return false;
            }

            if (!receivedQty || receivedQty <= 0) {
                alert('‚ö†Ô∏è L√ºtfen ge√ßerli bir teslim alƒ±nan miktar girin.');
                return false;
            }

            if (selectedItems.length > 0 && receivedQty > selectedItems[0].openQty) {
                alert('‚ö†Ô∏è Teslim alƒ±nan miktar a√ßƒ±k miktardan (' + selectedItems[0].openQty + ') fazla olamaz.');
                return false;
            }

            if (!warehouse || !location || !bin) {
                alert('‚ö†Ô∏è Storage, lokasyon ve raf bilgileri zorunludur.');
                return false;
            }

            return true;
        }

        // Save receipt
        function saveReceipt() {
            if (!validateReceiptForm()) return;

            const grNumber = document.getElementById('grId').value;
            const item = selectedItems[0];

            if (confirm('Mal kabul i≈ülemi kaydedilecek!\n\n' +
                'Mal Kabul No: ' + grNumber + '\n' +
                'Order number: ' + item.poNumber + '\n' +
                'Malzeme: ' + item.materialNo + '\n' +
                'Miktar: ' + document.getElementById('receivedQty').value + ' ' + item.uom + '\n' +
                'TRY Birim Maliyet: ' + document.getElementById('tryUnitCost').value + ' TL\n\n' +
                'Devam etmek istiyor musunuz?')) {

                alert('‚úÖ Mal kabul ba≈üarƒ±yla kaydedildi!\n\n' +
                    'Mal Kabul No: ' + grNumber + '\n' +
                    'Stock g√ºncellendi.\n' +
                    'FIFO maliyet kaydƒ± olu≈üturuldu.\n' +
                    'Denetim kaydƒ± olu≈üturuldu.\n\n' +
                    'API: POST /api/goods-receipts');

                resetForm();
            }
        }

        // Save batch receipt
        function saveBatchReceipt() {
            const invoiceNo = document.getElementById('batchInvoiceNumber').value.trim();
            const deliveryNo = document.getElementById('batchDeliveryNoteNumber').value.trim();

            if (!invoiceNo && !deliveryNo) {
                alert('‚ö†Ô∏è Invoice number veya Delivery note number\'dan en az biri zorunludur.');
                return;
            }

            // Validate all items
            let valid = true;
            document.querySelectorAll('.batch-warehouse').forEach(select => {
                if (!select.value) valid = false;
            });
            document.querySelectorAll('.batch-location').forEach(select => {
                if (!select.value) valid = false;
            });
            document.querySelectorAll('.batch-bin').forEach(input => {
                if (!input.value.trim()) valid = false;
            });

            if (!valid) {
                alert('‚ö†Ô∏è T√ºm kalemler i√ßin Storage, Location ve Bin bilgileri zorunludur.');
                return;
            }

            if (confirm('Toplu mal kabul i≈ülemi kaydedilecek!\n\n' +
                'Toplam ' + selectedItems.length + ' kalem i≈ülenecek.\n\n' +
                'Devam etmek istiyor musunuz?')) {

                alert('‚úÖ Toplu mal kabul ba≈üarƒ±yla kaydedildi!\n\n' +
                    selectedItems.length + ' kalem i≈ülendi.\n' +
                    'Stocklar g√ºncellendi.\n' +
                    'FIFO maliyet kayƒ±tlarƒ± olu≈üturuldu.\n\n' +
                    'API: POST /api/goods-receipts/batch');

                resetForm();
            }
        }


        // Cancel receipt
        function cancelReceipt() {
            if (confirm('Mal kabul formu iptal edilecek. Girilen bilgiler kaybolacak.\n\nDevam etmek istiyor musunuz?')) {
                closeReceiptForm();
            }
        }

        // Cancel batch receipt
        function cancelBatchReceipt() {
            if (confirm('Toplu mal kabul formu iptal edilecek.\n\nDevam etmek istiyor musunuz?')) {
                document.getElementById('multipleItemsSection').style.display = 'none';
                document.querySelectorAll('.item-select').forEach(cb => cb.checked = false);
                selectedItems = [];
                updateSelectedItems();
            }
        }

        // Close receipt form
        function closeReceiptForm() {
            document.getElementById('receiptFormSection').style.display = 'none';
            document.querySelectorAll('.item-select').forEach(cb => cb.checked = false);
            selectedItems = [];
        }

        // Search GR for rollback
        function searchGrForRollback() {
            const grNo = document.getElementById('rollbackGrNo').value.trim();
            if (!grNo) {
                alert('‚ö†Ô∏è L√ºtfen iptal edilecek GR numarasƒ±nƒ± girin.');
                return;
            }

            const gr = mockGrHistory[grNo];
            if (!gr) {
                alert('‚ö†Ô∏è GR bulunamadƒ±: ' + grNo);
                return;
            }

            document.getElementById('prevGrId').value = gr.grId;
            document.getElementById('prevStockRecordId').value = gr.stockRecordId;
            document.getElementById('rollbackPoNo').value = gr.poNumber;
            document.getElementById('rollbackMaterialNo').value = gr.materialNo;
            document.getElementById('rollbackQty').value = gr.qty;
            document.getElementById('rollbackUom').value = gr.uom;
            document.getElementById('rollbackGrDetails').style.display = 'block';
        }

        // Execute rollback
        function executeRollback() {
            const reason = document.getElementById('rollbackReason').value.trim();
            if (!reason) {
                alert('‚ö†Ô∏è ƒ∞ptal nedeni zorunludur.');
                return;
            }

            if (confirm('‚ö†Ô∏è Dƒ∞KKAT: Bu i≈ülem geri alƒ±namaz!\n\n' +
                'GR No: ' + document.getElementById('rollbackGrNo').value + '\n' +
                'Miktar: ' + document.getElementById('rollbackQty').value + ' ' + document.getElementById('rollbackUom').value + '\n\n' +
                'Stock ve maliyet kayƒ±tlarƒ± ters i≈ülem ile d√ºzeltilecek.\n\n' +
                'Devam etmek istiyor musunuz?')) {

                alert('‚úÖ Mal kabul iptal i≈ülemi ba≈üarƒ±yla tamamlandƒ±!\n\n' +
                    'Movement type: 102 - Rollback\n' +
                    'Stock azaltƒ±ldƒ±.\n' +
                    'Maliyet kaydƒ± ters i≈ülem ile d√ºzeltildi.\n' +
                    'Sipari≈ü kalemi tekrar a√ßƒ±k duruma getirildi.\n\n' +
                    'API: POST /api/goods-receipts/rollback');

                closeRollbackForm();
            }
        }

        // Close rollback form
        function closeRollbackForm() {
            document.getElementById('rollbackGrNo').value = '';
            document.getElementById('rollbackGrDetails').style.display = 'none';
            document.getElementById('rollbackReason').value = '';
            document.getElementById('transactionType').value = '101';
            handleTransactionTypeChange();
        }

        // Load GR details for return - Called when dropdown selection changes
        function loadGrDetailsForReturn(grNo) {
            const gr = mockGrHistory[grNo];

            // Hide both sections first
            document.getElementById('returnGrDetails').style.display = 'none';
            document.getElementById('returnGrNotFound').style.display = 'none';

            if (!gr) {
                // Show not found message
                document.getElementById('returnGrNotFound').style.display = 'block';
                return;
            }

            // Populate all fields from GR data
            // Step 2: GR Header Info
            document.getElementById('returnOriginalGrId').value = gr.grId;
            document.getElementById('returnOriginalGrDate').value = gr.grDate;
            document.getElementById('returnPoNo').value = gr.poNumber;
            document.getElementById('returnItemNo').value = gr.itemNo;

            // Step 3: Material Info
            document.getElementById('returnMaterialNo').value = gr.materialNo;
            document.getElementById('returnMaterialTitle').value = gr.materialTitle;
            document.getElementById('returnSupplier').value = gr.supplierTitle;

            // Step 4: Quantity Info
            document.getElementById('returnGrQty').value = gr.grQty;
            document.getElementById('returnCurrentStock').value = gr.currentStock;
            document.getElementById('returnQty').value = '';
            document.getElementById('returnQty').max = gr.currentStock;
            document.getElementById('returnUom').value = gr.uom;
            document.getElementById('returnEurPrice').value = gr.eurPrice.toFixed(2);
            document.getElementById('returnTotalEur').value = '0.00';

            // Step 5: Location Info
            document.getElementById('returnWarehouse').value = gr.warehouse;
            document.getElementById('returnLocation').value = gr.location;
            document.getElementById('returnBin').value = gr.bin;
            document.getElementById('returnStockRecordId').value = gr.stockRecordId;

            // Step 6: Clear reason fields
            document.getElementById('returnReasonType').value = '';
            document.getElementById('returnDescription').value = '';

            // Pre-select packing return reason for 161
            if (transactionType === '161') {
                document.getElementById('returnReasonType').value = 'PACKING_RETURN';
            }

            // Show the details section
            document.getElementById('returnGrDetails').style.display = 'block';

            // Scroll to form
            document.getElementById('returnGrDetails').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Calculate return total when quantity changes
        function calculateReturnTotal() {
            const qty = parseFloat(document.getElementById('returnQty').value) || 0;
            const eurPrice = parseFloat(document.getElementById('returnEurPrice').value) || 0;
            const total = qty * eurPrice;
            document.getElementById('returnTotalEur').value = total.toFixed(2);
        }

        // Execute return - Full implementation with validation
        function executeReturn() {
            const returnQty = parseFloat(document.getElementById('returnQty').value);
            const currentStock = parseFloat(document.getElementById('returnCurrentStock').value);
            const reasonType = document.getElementById('returnReasonType').value;
            const returnDate = document.getElementById('returnDate').value;

            // Validation
            if (!returnDate) {
                alert('‚ö†Ô∏è ƒ∞ade tarihi zorunludur.');
                document.getElementById('returnDate').focus();
                return;
            }

            if (!returnQty || returnQty <= 0) {
                alert('‚ö†Ô∏è Ge√ßerli bir iade miktarƒ± girin.');
                document.getElementById('returnQty').focus();
                return;
            }

            if (returnQty > currentStock) {
                alert('‚ö†Ô∏è ƒ∞ade miktarƒ± mevcut stoktan (' + currentStock + ') fazla olamaz.');
                document.getElementById('returnQty').focus();
                return;
            }

            if (!reasonType) {
                alert('‚ö†Ô∏è ƒ∞ade nedeni se√ßiniz.');
                document.getElementById('returnReasonType').focus();
                return;
            }

            const transactionType = document.getElementById('transactionType').value;
            const typeName = transactionType === '122' ? 'Malzeme ƒ∞ade' : 'Ambalaj ƒ∞ade';
            const returnId = document.getElementById('returnId').value;
            const originalGrId = document.getElementById('returnOriginalGrId').value;
            const materialNo = document.getElementById('returnMaterialNo').value;
            const materialTitle = document.getElementById('returnMaterialTitle').value;
            const uom = document.getElementById('returnUom').value;
            const totalEur = document.getElementById('returnTotalEur').value;
            const warehouse = document.getElementById('returnWarehouse').value;
            const location = document.getElementById('returnLocation').value;
            const bin = document.getElementById('returnBin').value;

            const confirmMsg = `${typeName} i≈ülemi kaydedilecek!\n\n` +
                `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n` +
                `ƒ∞ade No: ${returnId}\n` +
                `Orijinal GR: ${originalGrId}\n` +
                `Movement type: ${transactionType}\n` +
                `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n` +
                `Malzeme: ${materialNo}\n` +
                `${materialTitle}\n` +
                `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n` +
                `ƒ∞ade Miktarƒ±: ${returnQty} ${uom}\n` +
                `ƒ∞ade Tutarƒ±: ${totalEur} EUR\n` +
                `Location: ${warehouse}/${location}/${bin}\n` +
                `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n` +
                `‚ö†Ô∏è UYARI: Stock ${returnQty} ${uom} AZALTILACAK!\n\n` +
                `Devam etmek istiyor musunuz?`;

            if (confirm(confirmMsg)) {
                const successMsg = `‚úÖ ${typeName} i≈ülemi ba≈üarƒ±yla tamamlandƒ±!\n\n` +
                    `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n` +
                    `ƒ∞ade No: ${returnId}\n` +
                    `Movement type: ${transactionType} - ${typeName}\n` +
                    `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n` +
                    `‚úì Stock kaydƒ± g√ºncellendi (${currentStock} ‚Üí ${currentStock - returnQty} ${uom})\n` +
                    `‚úì Material Movement kaydƒ± olu≈üturuldu\n` +
                    `‚úì Maliyet kaydƒ± g√ºncellendi (-${totalEur} EUR)\n` +
                    `‚úì Audit trail olu≈üturuldu\n` +
                    `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n` +
                    `API: POST /api/goods-receipts/return`;

                alert(successMsg);
                closeReturnForm();
            }
        }

        // Close return form - Reset all fields
        function closeReturnForm() {
            // Reset search field
            document.getElementById('originalGrNo').value = '';

            // Hide detail sections
            document.getElementById('returnGrDetails').style.display = 'none';
            document.getElementById('returnGrNotFound').style.display = 'none';

            // Reset all form fields
            document.getElementById('returnOriginalGrId').value = '';
            document.getElementById('returnOriginalGrDate').value = '';
            document.getElementById('returnPoNo').value = '';
            document.getElementById('returnItemNo').value = '';
            document.getElementById('returnMaterialNo').value = '';
            document.getElementById('returnMaterialTitle').value = '';
            document.getElementById('returnSupplier').value = '';
            document.getElementById('returnGrQty').value = '';
            document.getElementById('returnCurrentStock').value = '';
            document.getElementById('returnQty').value = '';
            document.getElementById('returnUom').value = '';
            document.getElementById('returnEurPrice').value = '';
            document.getElementById('returnTotalEur').value = '';
            document.getElementById('returnWarehouse').value = '';
            document.getElementById('returnLocation').value = '';
            document.getElementById('returnBin').value = '';
            document.getElementById('returnStockRecordId').value = '';
            document.getElementById('returnReasonType').value = '';
            document.getElementById('returnDescription').value = '';

            // Generate new return ID
            document.getElementById('returnId').value = 'RET-2025-' + String(Math.floor(Math.random() * 1000000)).padStart(6, '0');

            // Reset to default transaction type
            document.getElementById('transactionType').value = '101';
            handleTransactionTypeChange();
        }

        // Apply filters
        function applyFilters() {
            const searchBox = document.getElementById('searchBox').value.toLowerCase().trim();
            const orderNo = document.getElementById('filterOrderNo').value.toLowerCase().trim();
            const itemNo = document.getElementById('filterItemNo').value.toLowerCase().trim();
            const materialNo = document.getElementById('filterMaterialNo').value.toLowerCase().trim();
            const materialTitle = document.getElementById('filterMaterialTitle').value.toLowerCase().trim();
            const supplierNo = document.getElementById('filterSupplierNo').value.toLowerCase().trim();
            const supplierTitle = document.getElementById('filterSupplierTitle').value.toLowerCase().trim();
            const uom = document.getElementById('filterUOM').value;

            const rows = document.querySelectorAll('#openItemsTable tr');
            let visibleCount = 0;

            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length === 0) return;

                // G√ºncel s√ºtun indeksleri (0-indexed):
                // 0: Select, 1: Exclude, 2: Order number, 3: Item number, 4: Material number, 5: Material title
                // 6: Supplier material number, 7: Supplier material title, 8: Supplier number, 9: Supplier title, 10: Unit of measure
                const rowOrderNo = cells[2].textContent.toLowerCase();
                const rowItemNo = cells[3].textContent.toLowerCase();
                const rowMaterialNo = cells[4].textContent.toLowerCase();
                const rowMaterialTitle = cells[5].textContent.toLowerCase();
                const rowSupplierNo = cells[8].textContent.toLowerCase();
                const rowSupplierTitle = cells[9].textContent.toLowerCase();
                const rowUom = cells[10].textContent;

                let visible = true;

                // Genel arama kutusu - t√ºm √∂nemli alanlarda ara
                if (searchBox && !(
                    rowOrderNo.includes(searchBox) ||
                    rowMaterialNo.includes(searchBox) ||
                    rowMaterialTitle.includes(searchBox) ||
                    rowSupplierNo.includes(searchBox) ||
                    rowSupplierTitle.includes(searchBox)
                )) {
                    visible = false;
                }

                // Spesifik filtreler
                if (orderNo && !rowOrderNo.includes(orderNo)) visible = false;
                if (itemNo && !rowItemNo.includes(itemNo)) visible = false;
                if (materialNo && !rowMaterialNo.includes(materialNo)) visible = false;
                if (materialTitle && !rowMaterialTitle.includes(materialTitle)) visible = false;
                if (supplierNo && !rowSupplierNo.includes(supplierNo)) visible = false;
                if (supplierTitle && !rowSupplierTitle.includes(supplierTitle)) visible = false;
                if (uom && rowUom !== uom) visible = false;

                row.style.display = visible ? '' : 'none';
                if (visible) visibleCount++;
            });

            document.getElementById('openItemsCount').textContent = visibleCount + ' A√ßƒ±k Item number';
        }

        // Clear filters
        function clearFilters() {
            document.getElementById('searchBox').value = '';
            document.getElementById('filterOrderNo').value = '';
            document.getElementById('filterItemNo').value = '';
            document.getElementById('filterMaterialNo').value = '';
            document.getElementById('filterMaterialTitle').value = '';
            document.getElementById('filterSupplierNo').value = '';
            document.getElementById('filterSupplierTitle').value = '';
            document.getElementById('filterUOM').value = '';

            const rows = document.querySelectorAll('#openItemsTable tr');
            rows.forEach(row => {
                row.style.display = '';
            });

            document.getElementById('openItemsCount').textContent = rows.length + ' A√ßƒ±k Item number';
        }

        // Reset form
        function resetForm() {
            document.getElementById('receiptFormSection').style.display = 'none';
            document.getElementById('multipleItemsSection').style.display = 'none';
            document.querySelectorAll('.item-select').forEach(cb => cb.checked = false);
            document.getElementById('selectAllItems').checked = false;
            selectedItems = [];

            // Generate new GR ID
            document.getElementById('grId').value = 'GR-2025-' + String(Math.floor(Math.random() * 1000000)).padStart(6, '0');

            // Clear document fields
            document.getElementById('invoiceNumber').value = '';
            document.getElementById('invoiceDate').value = '';
            document.getElementById('deliveryNoteNumber').value = '';
            document.getElementById('deliveryNoteDate').value = '';
            document.getElementById('batchInvoiceNumber').value = '';
            document.getElementById('batchInvoiceDate').value = '';
            document.getElementById('batchDeliveryNoteNumber').value = '';
            document.getElementById('batchDeliveryNoteDate').value = '';

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Initialize with default transaction type
        document.getElementById('transactionType').value = '101';
        handleTransactionTypeChange();
    </script>

    <!-- DEVELOPER DOCUMENTATION PANEL -->
    <div id="devDocsPanel" class="dev-docs-panel">
        <button class="dev-docs-toggle" onclick="toggleDevDocs()">üìã Geli≈ütirici Dok√ºmantasyonu</button>
        <div class="dev-docs-content" id="devDocsContent">
            <div class="dev-docs-header">
                <h2>üìã 13 GR - Goods Receipt</h2>
                <button class="dev-docs-close" onclick="toggleDevDocs()">‚úï</button>
            </div>
            <div class="dev-docs-body">
                <div class="dev-docs-tabs">
                    <button class="dev-tab active" onclick="showDevTab('dataStructure')">Veri Yapƒ±larƒ±</button>
                    <button class="dev-tab" onclick="showDevTab('formFields')">Form Alanlarƒ±</button>
                    <button class="dev-tab" onclick="showDevTab('businessRules')">ƒ∞≈ü Kurallarƒ±</button>
                    <button class="dev-tab" onclick="showDevTab('movementTypes')">Hareket Tipleri</button>
                </div>

                <div id="dataStructure" class="dev-tab-content active">
                    <h3>TABLE: Cost (Goods Receipt)</h3>
                    <table class="dev-table">
                        <thead><tr><th>Field Name</th><th>Type</th><th>Length</th><th>Description</th></tr></thead>
                        <tbody>
                            <tr><td>Cost ID</td><td>int</td><td>8</td><td>Primary key</td></tr>
                            <tr><td>Total Quantity</td><td>float</td><td>15</td><td>Toplam miktar</td></tr>
                            <tr><td>Total Euro Cost</td><td>float</td><td>14</td><td>Toplam Euro maliyet</td></tr>
                            <tr><td>Total TRY Cost</td><td>float</td><td>14</td><td>Toplam TRY maliyet</td></tr>
                            <tr><td>Consumed Quantity</td><td>float</td><td>15</td><td>T√ºketilen miktar (FIFO)</td></tr>
                            <tr><td>Consumed Euro Value</td><td>float</td><td>14</td><td>T√ºketilen Euro deƒüer</td></tr>
                            <tr><td>Consumed TRY Value</td><td>float</td><td>14</td><td>T√ºketilen TRY deƒüer</td></tr>
                            <tr><td>Totally consumed check</td><td>bool</td><td>-</td><td>Tamamen t√ºketildi mi</td></tr>
                            <tr><td>Storage code</td><td>text</td><td>12</td><td>Depo kodu</td></tr>
                            <tr><td>Location code</td><td>text</td><td>12</td><td>Lokasyon kodu</td></tr>
                            <tr><td>Bin code</td><td>text</td><td>12</td><td>Bin kodu</td></tr>
                            <tr><td>Block for issue check</td><td>bool</td><td>-</td><td>√áƒ±kƒ±≈ü i√ßin bloklu</td></tr>
                            <tr><td>Euro Unit cost</td><td>float</td><td>14</td><td>Birim Euro maliyet</td></tr>
                            <tr><td>TRY Unit cost</td><td>float</td><td>14</td><td>Birim TRY maliyet</td></tr>
                            <tr><td>Original currency code</td><td>text</td><td>3</td><td>Orijinal para birimi</td></tr>
                            <tr><td>Original goods receipt unit price</td><td>float</td><td>14</td><td>Orijinal birim fiyat</td></tr>
                            <tr><td>Goods receipt date time</td><td>datetime</td><td>-</td><td>Mal kabul tarihi</td></tr>
                            <tr><td>Goods receipt document date</td><td>date</td><td>-</td><td>Belge tarihi</td></tr>
                            <tr><td>Material Movement Header number</td><td>int</td><td>8</td><td>ƒ∞lgili hareket header ID</td></tr>
                            <tr><td>Material Movement Item number</td><td>int</td><td>4</td><td>ƒ∞lgili hareket item ID</td></tr>
                        </tbody>
                    </table>

                    <h3>TABLE: Purchasing Order Item</h3>
                    <table class="dev-table">
                        <thead><tr><th>Field Name</th><th>Type</th><th>Length</th><th>Description</th></tr></thead>
                        <tbody>
                            <tr><td>Purchasing Order item Id</td><td>int</td><td>12</td><td>Primary key</td></tr>
                            <tr><td>Purchasing Order SAP no</td><td>int</td><td>10</td><td>SAP sipari≈ü no</td></tr>
                            <tr><td>Purchasing Order SAP Item No</td><td>int</td><td>4</td><td>SAP kalem no</td></tr>
                            <tr><td>Material number</td><td>text</td><td>13</td><td>Malzeme numarasƒ±</td></tr>
                            <tr><td>Unit of measure code</td><td>text</td><td>3</td><td>√ñl√ß√º birimi kodu</td></tr>
                            <tr><td>Order quantity</td><td>float</td><td>15</td><td>Sipari≈ü miktarƒ±</td></tr>
                            <tr><td>Goods receipt quantity</td><td>float</td><td>15</td><td>Kabul edilen miktar</td></tr>
                            <tr><td>Unit price</td><td>float</td><td>14</td><td>Birim fiyat</td></tr>
                            <tr><td>currency code</td><td>text</td><td>3</td><td>Para birimi</td></tr>
                            <tr><td>creation datetime</td><td>datetime</td><td>-</td><td>Kayƒ±t olu≈üturma tarihi</td></tr>
                            <tr><td>Created by user id</td><td>int</td><td>8</td><td>Olu≈üturan kullanƒ±cƒ± ID</td></tr>
                        </tbody>
                    </table>
                </div>

                <div id="formFields" class="dev-tab-content">
                    <h3>Goods Receipt Form (Sipari≈ü Bilgileri - Readonly)</h3>
                    <table class="dev-table">
                        <thead><tr><th>Alan</th><th>Tip</th><th>A√ßƒ±klama</th></tr></thead>
                        <tbody>
                            <tr><td>Goods receipt Id</td><td>readonly</td><td>GR numarasƒ± (otomatik)</td></tr>
                            <tr><td>SRM no</td><td>readonly</td><td>ƒ∞li≈ükili SRM numarasƒ±</td></tr>
                            <tr><td>Purchasing Order no</td><td>readonly</td><td>Satƒ±nalma sipari≈ü no</td></tr>
                            <tr><td>Material number</td><td>readonly</td><td>Malzeme numarasƒ±</td></tr>
                            <tr><td>Material title</td><td>readonly</td><td>Malzeme ba≈ülƒ±ƒüƒ±</td></tr>
                            <tr><td>Supplier number</td><td>readonly</td><td>Tedarik√ßi numarasƒ±</td></tr>
                            <tr><td>Supplier title</td><td>readonly</td><td>Tedarik√ßi adƒ±</td></tr>
                            <tr><td>Supplier material number</td><td>readonly</td><td>Tedarik√ßi malzeme no</td></tr>
                            <tr><td>Supplier material title</td><td>readonly</td><td>Tedarik√ßi malzeme adƒ±</td></tr>
                        </tbody>
                    </table>
                    <h3>Storage Assignment (Depo Atama)</h3>
                    <table class="dev-table">
                        <thead><tr><th>Alan</th><th>Tip</th><th>A√ßƒ±klama</th></tr></thead>
                        <tbody>
                            <tr><td>Default storage *</td><td>dropdown</td><td>Depo se√ßimi (malzeme master'dan varsayƒ±lan)</td></tr>
                            <tr><td>Default Location *</td><td>dropdown</td><td>Lokasyon se√ßimi</td></tr>
                            <tr><td>Default bin *</td><td>dropdown</td><td>Bin se√ßimi</td></tr>
                        </tbody>
                    </table>
                    <h3>Cost Information (Maliyet Bilgileri)</h3>
                    <table class="dev-table">
                        <thead><tr><th>Alan</th><th>Tip</th><th>A√ßƒ±klama</th></tr></thead>
                        <tbody>
                            <tr><td>Cost Id</td><td>readonly</td><td>Maliyet kaydƒ± ID (otomatik)</td></tr>
                            <tr><td>Euro Unit cost</td><td>readonly</td><td>Euro birim maliyeti (hesaplanan)</td></tr>
                            <tr><td>Exchange Rate (EUR/TRY)</td><td>readonly</td><td>Merkez Bankasƒ± satƒ±≈ü kuru</td></tr>
                            <tr><td>TRY unit cost</td><td>readonly</td><td>TL birim maliyeti (EUR √ó Kur)</td></tr>
                            <tr><td>Cost date</td><td>date</td><td>Maliyet tarihi</td></tr>
                            <tr><td>Exchange Rate Date</td><td>readonly</td><td>Kur tarihi (belge tarihinden)</td></tr>
                            <tr><td>Total Euro Cost</td><td>readonly</td><td>Toplam Euro maliyet</td></tr>
                            <tr><td>Total TRY Cost</td><td>readonly</td><td>Toplam TL maliyet</td></tr>
                            <tr><td>Quality Check Status</td><td>dropdown</td><td>Kalite kontrol durumu</td></tr>
                            <tr><td>Blocked for Material Request</td><td>checkbox</td><td>Malzeme taleplerinde bloklu</td></tr>
                        </tbody>
                    </table>
                    <h3>Quantity and Document (Miktar ve Belge)</h3>
                    <table class="dev-table">
                        <thead><tr><th>Alan</th><th>Tip</th><th>A√ßƒ±klama</th></tr></thead>
                        <tbody>
                            <tr><td>Order quantity</td><td>readonly</td><td>Sipari≈ü miktarƒ±</td></tr>
                            <tr><td>Receipt quantity *</td><td>number</td><td>Teslim alƒ±nan miktar</td></tr>
                            <tr><td>Invoice number</td><td>text</td><td>Fatura numarasƒ± (en az biri zorunlu)</td></tr>
                            <tr><td>Delivery note number</td><td>text</td><td>ƒ∞rsaliye numarasƒ± (en az biri zorunlu)</td></tr>
                            <tr><td>Invoice document Date</td><td>date</td><td>Fatura tarihi</td></tr>
                            <tr><td>Delivery note document date</td><td>date</td><td>ƒ∞rsaliye tarihi</td></tr>
                            <tr><td>Entry date</td><td>readonly</td><td>Kayƒ±t tarihi (otomatik)</td></tr>
                            <tr><td>Order closed checkbox</td><td>checkbox</td><td>Sipari≈ü kapatƒ±ldƒ± mƒ±?</td></tr>
                        </tbody>
                    </table>
                    <h3>Transaction Type (ƒ∞≈ülem Tipi)</h3>
                    <table class="dev-table">
                        <thead><tr><th>Alan</th><th>Tip</th><th>A√ßƒ±klama</th></tr></thead>
                        <tbody>
                            <tr><td>Transaction type number</td><td>dropdown</td><td>Hareket tipi se√ßimi (1-15)</td></tr>
                            <tr><td>Transaction type title</td><td>readonly</td><td>Hareket tipi a√ßƒ±klamasƒ±</td></tr>
                        </tbody>
                    </table>
                    <h3>Label Printing (Etiket Yazdƒ±rma)</h3>
                    <table class="dev-table">
                        <thead><tr><th>Alan</th><th>Tip</th><th>A√ßƒ±klama</th></tr></thead>
                        <tbody>
                            <tr><td>Unit quantity in a package</td><td>number</td><td>Paket i√ßi birim sayƒ±sƒ±</td></tr>
                            <tr><td>Label quantity</td><td>readonly</td><td>Etiket adedi (hesaplanan)</td></tr>
                        </tbody>
                    </table>
                    <h3>Stock Record (Stok Kaydƒ± - Readonly)</h3>
                    <table class="dev-table">
                        <thead><tr><th>Alan</th><th>Tip</th><th>A√ßƒ±klama</th></tr></thead>
                        <tbody>
                            <tr><td>Stock Record Id</td><td>readonly</td><td>Stok kaydƒ± ID</td></tr>
                            <tr><td>Previous Stock Record Id</td><td>readonly</td><td>√ñnceki stok kaydƒ±</td></tr>
                            <tr><td>Stock</td><td>readonly</td><td>Depo</td></tr>
                            <tr><td>Location</td><td>readonly</td><td>Lokasyon</td></tr>
                            <tr><td>Bin</td><td>readonly</td><td>Bin</td></tr>
                            <tr><td>Quantity</td><td>readonly</td><td>Miktar</td></tr>
                        </tbody>
                    </table>
                </div>

                <div id="businessRules" class="dev-tab-content">
                    <h3>Mal Kabul Kurallarƒ±</h3>
                    <ul>
                        <li><strong>FIFO prensibi:</strong> En eski stok √∂nce t√ºketilir</li>
                        <li>En az bir <strong>irsaliye veya fatura numarasƒ±</strong> zorunlu</li>
                        <li>Paket bilgisi varsa <strong>etiket adedi</strong> hesaplanƒ±r</li>
                        <li><strong>Kƒ±smi teslimat</strong> ile sipari≈ü kapatƒ±labilir</li>
                        <li>D√∂viz kuru <strong>satƒ±≈ü kuru</strong> √ºzerinden hesaplanƒ±r</li>
                    </ul>

                    <h3>Kabul Miktarƒ± Kurallarƒ±</h3>
                    <ul>
                        <li>Kabul miktarƒ± ‚â§ Sipari≈ü miktarƒ± olmalƒ±</li>
                        <li>Kalan miktar = Sipari≈ü miktarƒ± - √ñnceki kabuller</li>
                        <li>Fazla kabul yapƒ±lamaz (validation)</li>
                    </ul>

                    <h3>Maliyet Hesaplama</h3>
                    <ul>
                        <li><strong>Euro Unit Cost:</strong> Original Price / Exchange Rate</li>
                        <li><strong>TRY Unit Cost:</strong> Original Price * TRY Exchange Rate</li>
                        <li><strong>Total Cost:</strong> Unit Cost * Quantity</li>
                    </ul>
                </div>

                <div id="movementTypes" class="dev-tab-content">
                    <h3>Material Movement Types</h3>
                    <table class="dev-table">
                        <thead><tr><th>Code</th><th>Type</th><th>Description</th></tr></thead>
                        <tbody>
                            <tr><td>1</td><td>Goods Receipt</td><td>Mal kabul</td></tr>
                            <tr><td>2</td><td>Goods Receipt Rollback</td><td>Mal kabul iptali</td></tr>
                            <tr><td>3</td><td>Goods Return</td><td>Mal iade</td></tr>
                            <tr><td>4</td><td>Material transfer entry</td><td>Transfer giri≈ü</td></tr>
                            <tr><td>5</td><td>Material transfer exit</td><td>Transfer √ßƒ±kƒ±≈ü</td></tr>
                            <tr><td>6</td><td>Goods issue</td><td>Malzeme √ßƒ±kƒ±≈ü</td></tr>
                            <tr><td>7</td><td>Goods issue rollback</td><td>√áƒ±kƒ±≈ü iptali</td></tr>
                            <tr><td>8</td><td>Inventory positive</td><td>Sayƒ±m fazlasƒ±</td></tr>
                            <tr><td>9</td><td>Inventory negative</td><td>Sayƒ±m eksiƒüi</td></tr>
                            <tr><td>10</td><td>Packing material receipt</td><td>Ambalaj kabul</td></tr>
                            <tr><td>11</td><td>Packing material return</td><td>Ambalaj iade</td></tr>
                            <tr><td>12</td><td>Scrapping</td><td>Hurda</td></tr>
                            <tr><td>13</td><td>Scrapping Rollback</td><td>Hurda iptali</td></tr>
                            <tr><td>14</td><td>Other material issue</td><td>Diƒüer √ßƒ±kƒ±≈ü</td></tr>
                            <tr><td>15</td><td>Other material issue rollback</td><td>Diƒüer √ßƒ±kƒ±≈ü iptali</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <style>
        .dev-docs-panel { position: fixed; bottom: 0; left: 0; right: 0; z-index: 9999; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .dev-docs-toggle { position: fixed; bottom: 20px; right: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 20px; border-radius: 25px; cursor: pointer; font-size: 14px; font-weight: 600; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
        .dev-docs-toggle:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5); }
        .dev-docs-content { display: none; position: fixed; bottom: 0; left: 0; right: 0; height: 60vh; background: #1a1a2e; color: #e0e0e0; box-shadow: 0 -5px 30px rgba(0,0,0,0.3); }
        .dev-docs-content.active { display: flex; flex-direction: column; }
        .dev-docs-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .dev-docs-header h2 { margin: 0; font-size: 18px; }
        .dev-docs-close { background: rgba(255,255,255,0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 18px; }
        .dev-docs-body { flex: 1; overflow-y: auto; padding: 20px 25px; }
        .dev-docs-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .dev-tab { background: #2a2a4a; border: none; color: #aaa; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; }
        .dev-tab:hover { background: #3a3a5a; color: #fff; }
        .dev-tab.active { background: #667eea; color: white; }
        .dev-tab-content { display: none; }
        .dev-tab-content.active { display: block; }
        .dev-tab-content h3 { color: #667eea; margin: 20px 0 10px 0; font-size: 16px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .dev-tab-content h3:first-child { margin-top: 0; }
        .dev-tab-content ul { margin: 0; padding-left: 20px; }
        .dev-tab-content li { margin: 8px 0; line-height: 1.5; }
        .dev-table { width: 100%; border-collapse: collapse; margin: 10px 0; font-size: 13px; }
        .dev-table th { background: #2a2a4a; color: #667eea; text-align: left; padding: 10px; border: 1px solid #333; }
        .dev-table td { padding: 8px 10px; border: 1px solid #333; }
        .dev-table tr:hover { background: #2a2a4a; }
    </style>
    <script>
        function toggleDevDocs() { const c = document.getElementById('devDocsContent'); const t = document.querySelector('.dev-docs-toggle'); c.classList.toggle('active'); t.style.display = c.classList.contains('active') ? 'none' : 'block'; }
        function showDevTab(tabId) { document.querySelectorAll('.dev-tab-content').forEach(c => c.classList.remove('active')); document.querySelectorAll('.dev-tab').forEach(t => t.classList.remove('active')); document.getElementById(tabId).classList.add('active'); event.target.classList.add('active'); }
    </script>
</body>
</html>
