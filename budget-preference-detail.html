<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Tercih Detay - IMMA</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<!--
================================================================================
IMMA DEVELOPER DOCUMENTATION
================================================================================

SCREEN: 15 BP - Budget Preference (Detail)
FILE: budget-preference-detail.html
LAST UPDATED: 2025-12-18

--------------------------------------------------------------------------------
RELATED DATABASE TABLES
--------------------------------------------------------------------------------

TABLE: Budget Preference
| Field Name                    | Type | Length | Description                 |
|-------------------------------|------|--------|-----------------------------|
| Budget Preference Id          | int  | 8      | Primary key                 |
| Budget Approval request Type  | char | 1      | Onay tipi kodu (1-6)        |
| Department code               | text | 8      | Departman kodu              |

--------------------------------------------------------------------------------
BUDGET APPROVAL REQUEST TYPES
--------------------------------------------------------------------------------

| Code | Type Name                           | Description                        |
|------|-------------------------------------|------------------------------------|
| 1    | SL Approval                         | Her talep i√ßin SL onayƒ± gerekli    |
| 2    | SL over budget approval             | Sadece b√ºt√ße a≈üƒ±mƒ±nda SL onayƒ±     |
| 3    | Manager approval                    | Her talep i√ßin y√∂netici onayƒ±      |
| 4    | Manager Over budget Approval        | Sadece b√ºt√ße a≈üƒ±mƒ±nda y√∂netici     |
| 5    | Only TL and above material request  | Sadece TL ve √ºst√º talep yapabilir  |
| 6    | Budget approval doesn't required    | B√ºt√ße onayƒ± gerekmez               |

--------------------------------------------------------------------------------
BUSINESS RULES
--------------------------------------------------------------------------------

1. Her departman i√ßin tek bir Budget Preference olabilir
2. Approval Type departmanƒ±n t√ºm talep akƒ±≈ülarƒ±nƒ± belirler
3. Department code benzersiz olmalƒ± (unique per department)
4. Aktif/Pasif durumu belirlenebilir
5. Ge√ßerlilik ba≈ülangƒ±√ß tarihi belirlenebilir

--------------------------------------------------------------------------------
FORM MODES
--------------------------------------------------------------------------------

- view: T√ºm alanlar disabled, sadece g√∂r√ºnt√ºleme
- edit: Department ve Approval Type d√ºzenlenebilir
- create: Yeni preference olu≈üturma

URL Parametreleri:
- mode: view | edit | create
- id: Budget Preference ID (view/edit i√ßin)

--------------------------------------------------------------------------------
FIELD VALIDATIONS
--------------------------------------------------------------------------------

- Budget Preference Id: Otomatik olu≈üturulur (readonly)
- Budget Approval Request Type: Zorunlu (1-6 arasƒ±)
- Department Code: Zorunlu (text, maxlength=8)

--------------------------------------------------------------------------------
INTEGRATION NOTES
--------------------------------------------------------------------------------

- Material Request olu≈üturulurken bu preference kontrol edilir
- Approval akƒ±≈üƒ± bu preference'a g√∂re belirlenir
- Budget tablosuyla b√ºt√ße a≈üƒ±mƒ± kontrol√º i√ßin entegrasyon

================================================================================
-->
<body>
    <!-- NAVBAR - Top Navigation (Maximo Style) -->
    <nav class="modern-navbar">
        <div class="navbar-container">
            <a href="index.html" class="navbar-brand">
                <div class="navbar-logo">M</div>
                <div class="brand-text">
                    <span class="brand-name">IMMA</span>
                    <span class="brand-subtitle">Endirek Malzeme Y√∂netimi</span>
                </div>
            </a>
            <ul class="navbar-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <span class="nav-icon">üìä</span>
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="material-list.html" class="nav-link">
                        <span class="nav-icon">üì¶</span>
                        Ana Veriler
                    </a>
                    <div class="dropdown-menu">
                        <a href="material-list.html" class="dropdown-item">Malzeme Listesi</a>
                        <a href="supplier-list.html" class="dropdown-item">Tedarik√ßi Listesi</a>
                        <a href="storage-type-list.html" class="dropdown-item">Depo Tipi Listesi</a>
                        <a href="number-series.html" class="dropdown-item">Numara Serileri</a>
                        <a href="material-group.html" class="dropdown-item">Malzeme Gruplarƒ±</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="mrp.html" class="nav-link">
                        <span class="nav-icon">üìà</span>
                        MRP
                    </a>
                </li>
                <li class="nav-item">
                    <a href="srm-list.html" class="nav-link">
                        <span class="nav-icon">üõí</span>
                        Satƒ±nalma
                    </a>
                    <div class="dropdown-menu">
                        <a href="srm-list.html" class="dropdown-item">Talep Listesi</a>
                        <a href="goods-receipt.html" class="dropdown-item">Mal Kabul</a>
                        <a href="po-list.html" class="dropdown-item">Satƒ±nalma Sipari≈üleri</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="budget-management.html" class="nav-link active">
                        <span class="nav-icon">üí∞</span>
                        Budget
                    </a>
                    <div class="dropdown-menu">
                        <a href="budget-management.html" class="dropdown-item">B√ºt√ße Y√∂netimi</a>
                        <a href="budget-preference.html" class="dropdown-item active">B√ºt√ße Tercihleri</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="material-request-list.html" class="nav-link">
                        <span class="nav-icon">üìã</span>
                        Talepler
                    </a>
                    <div class="dropdown-menu">
                        <a href="material-request-list.html" class="dropdown-item">Talep Listesi</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="transfer-list.html" class="nav-link">
                        <span class="nav-icon">üè≠</span>
                        Stock
                    </a>
                    <div class="dropdown-menu">
                        <a href="direct-issue.html" class="dropdown-item">Doƒürudan √áƒ±kƒ±≈ü</a>
                        <a href="warehouse-transfer.html" class="dropdown-item">Depo Transferi</a>
                        <a href="transfer-list.html" class="dropdown-item">Transfer Listesi</a>
                        <a href="inventory-counting.html" class="dropdown-item">Sayƒ±m ƒ∞≈ülemleri</a>
                        <a href="single-material-counting.html" class="dropdown-item">Tekli Malzeme Sayƒ±mƒ±</a>
                        <a href="scrapping.html" class="dropdown-item">Hurda ƒ∞≈ülemleri</a>
                    </div>
                </li>
            </ul>
            <div class="navbar-user">
                <span class="user-name">Ahmet Yƒ±lmaz</span>
                <div class="user-avatar">AY</div>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="modern-container">
        <div class="page-header">
            <div>
                <h1 class="page-title" id="pageTitle">Budget Tercih Detay</h1>
                <p class="page-subtitle">Budget > B√ºt√ße Tercihleri > <span id="breadcrumbAction">G√∂r√ºnt√ºle</span></p>
            </div>
            <div class="page-actions">
                <a href="budget-preference.html" class="btn btn-outline">‚Üê Listeye D√∂n</a>
                <button class="btn btn-primary" id="editModeBtn" style="display: none;">D√ºzenle</button>
            </div>
        </div>

        <!-- Preference Form -->
        <div class="card">
            <div class="card-header">
                <h3 id="formTitle">Budget Preference Information</h3>
            </div>
            <div class="card-body">
                <form id="preferenceForm">
                    <div class="form-row">
                        <div class="form-group col-4">
                            <label>Budget Preference Id</label>
                            <input type="text" class="form-control" id="preferenceId" readonly>
                            <small class="form-text">Otomatik olu≈üturulur</small>
                        </div>
                        <div class="form-group col-4">
                            <label>Budget Approval Request Type <span class="required">*</span></label>
                            <select class="form-control" id="approvalRequestType" required>
                                <option value="">Se√ßiniz...</option>
                                <option value="1">1 - SL Approval</option>
                                <option value="2">2 - SL over budget approval</option>
                                <option value="3">3 - Manager approval</option>
                                <option value="4">4 - Manager Over budget Approval</option>
                                <option value="5">5 - Only TL and above material request</option>
                                <option value="6">6 - Budget approval doesn't required</option>
                            </select>
                            <small class="form-text">Onay s√ºrecinin tipi</small>
                        </div>
                        <div class="form-group col-4">
                            <label>Department Code <span class="required">*</span></label>
                            <select class="form-control" id="departmentCode" required>
                                <option value="">Se√ßiniz...</option>
                                <option value="BAKIM">BAKIM - Bakƒ±m Departmentƒ±</option>
                                <option value="URETIM">URETIM - √úretim Departmentƒ±</option>
                                <option value="KALITE">KALITE - Kalite Kontrol</option>
                                <option value="LOJISTIK">LOJISTIK - Lojistik</option>
                                <option value="ARASTIRMA">ARASTIRMA - Ar-Ge</option>
                            </select>
                            <small class="form-text">Tercih uygulanacak departman</small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group col-4" id="thresholdGroup">
                            <label>Threshold Value</label>
                            <input type="number" class="form-control" id="thresholdValue">
                            <small class="form-text">Hibrit tip i√ßin limit deƒüeri</small>
                        </div>
                        <div class="form-group col-4">
                            <label>Active Status</label>
                            <select class="form-control" id="activeStatus">
                                <option value="ACTIVE" selected>Aktif</option>
                                <option value="INACTIVE">Pasif</option>
                            </select>
                            <small class="form-text">Tercih durumu</small>
                        </div>
                        <div class="form-group col-4">
                            <label>Validity Start Date</label>
                            <input type="date" class="form-control" id="validFrom" value="2025-01-01">
                            <small class="form-text">Tercih ba≈ülangƒ±√ß tarihi</small>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions" style="margin-top: 30px;" id="formActions">
                        <a href="budget-preference.html" class="btn btn-outline">ƒ∞ptal</a>
                        <button type="submit" class="btn btn-primary" id="saveBtn">Kaydet</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Info Note -->

        <!-- Database Schema -->
    </main>

    <style>
        .required {
            color: #dc3545;
            font-weight: bold;
        }
        .form-text {
            display: block;
            margin-top: 4px;
            font-size: 11px;
            color: #6c757d;
        }
        .form-control[readonly] {
            background-color: #f5f5f5;
        }
        .form-control:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }
    </style>

    <script>
        // Sample data (backend'den gelecek)
        // Budget Approval Request Type: 1-6 arasƒ± deƒüerler (IMMA Data Structure)
        const budgetPreferences = {
            'BP-2025-001': {
                id: 'BP-2025-001',
                departmentCode: 'BAKIM',
                departmentName: 'Bakƒ±m Departmentƒ±',
                approvalType: '1',
                thresholdValue: null,
                status: 'ACTIVE',
                validFrom: '2025-01-01'
            },
            'BP-2025-002': {
                id: 'BP-2025-002',
                departmentCode: 'URETIM',
                departmentName: '√úretim Departmentƒ±',
                approvalType: '2',
                thresholdValue: null,
                status: 'ACTIVE',
                validFrom: '2025-01-01'
            },
            'BP-2025-003': {
                id: 'BP-2025-003',
                departmentCode: 'KALITE',
                departmentName: 'Kalite Kontrol',
                approvalType: '3',
                thresholdValue: null,
                status: 'ACTIVE',
                validFrom: '2025-01-01'
            },
            'BP-2025-004': {
                id: 'BP-2025-004',
                departmentCode: 'LOJISTIK',
                departmentName: 'Lojistik',
                approvalType: '5',
                thresholdValue: null,
                status: 'ACTIVE',
                validFrom: '2025-01-01'
            },
            'BP-2024-099': {
                id: 'BP-2024-099',
                departmentCode: 'ARASTIRMA',
                departmentName: 'Ar-Ge',
                approvalType: '6',
                thresholdValue: null,
                status: 'INACTIVE',
                validFrom: '2024-01-01'
            }
        };

        // URL parametrelerini al
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                mode: params.get('mode') || 'view',
                id: params.get('id') || null
            };
        }

        // Sayfa moduna g√∂re ayarla
        function initializePage() {
            const { mode, id } = getUrlParams();
            const formElements = document.querySelectorAll('#preferenceForm input:not([type="checkbox"]), #preferenceForm select');

            switch(mode) {
                case 'view':
                    document.getElementById('pageTitle').textContent = 'Budget Tercih G√∂r√ºnt√ºle';
                    document.getElementById('breadcrumbAction').textContent = 'G√∂r√ºnt√ºle';
                    document.getElementById('formTitle').textContent = 'Budget Preference Information (Read Only)';
                    document.getElementById('editModeBtn').style.display = 'inline-block';
                    document.getElementById('formActions').style.display = 'none';

                    // T√ºm alanlarƒ± disabled yap
                    formElements.forEach(el => {
                        el.disabled = true;
                    });

                    // D√ºzenle butonuna tƒ±klayƒ±nca edit moduna ge√ß
                    document.getElementById('editModeBtn').addEventListener('click', function() {
                        window.location.href = `budget-preference-detail.html?mode=edit&id=${id}`;
                    });

                    if (id && budgetPreferences[id]) {
                        loadPreferenceData(budgetPreferences[id]);
                    }
                    break;

                case 'edit':
                    document.getElementById('pageTitle').textContent = 'Budget Tercih D√ºzenle';
                    document.getElementById('breadcrumbAction').textContent = 'D√ºzenle';
                    document.getElementById('formTitle').textContent = 'Budget Tercih D√ºzenleme';
                    document.getElementById('editModeBtn').style.display = 'none';
                    document.getElementById('formActions').style.display = 'flex';

                    // Alanlarƒ± aktif yap (readonly olanlar hari√ß)
                    formElements.forEach(el => {
                        if (!el.hasAttribute('readonly')) {
                            el.disabled = false;
                        }
                    });

                    if (id && budgetPreferences[id]) {
                        loadPreferenceData(budgetPreferences[id]);
                    }
                    break;

                case 'create':
                    document.getElementById('pageTitle').textContent = 'Yeni Budget Tercihi Olu≈ütur';
                    document.getElementById('breadcrumbAction').textContent = 'Yeni';
                    document.getElementById('formTitle').textContent = 'Yeni Budget Tercihi';
                    document.getElementById('editModeBtn').style.display = 'none';
                    document.getElementById('formActions').style.display = 'flex';

                    // Yeni ID olu≈ütur
                    const newId = 'BP-2025-' + String(Math.floor(Math.random() * 900) + 100);
                    document.getElementById('preferenceId').value = newId;

                    // Alanlarƒ± aktif yap
                    formElements.forEach(el => {
                        if (!el.hasAttribute('readonly')) {
                            el.disabled = false;
                        }
                    });
                    break;
            }

            updateThresholdVisibility();
        }

        // Tercih verilerini forma y√ºkle
        function loadPreferenceData(preference) {
            document.getElementById('preferenceId').value = preference.id;
            document.getElementById('approvalRequestType').value = preference.approvalType;
            document.getElementById('departmentCode').value = preference.departmentCode;
            document.getElementById('thresholdValue').value = preference.thresholdValue || '';
            document.getElementById('activeStatus').value = preference.status;
            document.getElementById('validFrom').value = preference.validFrom;

            updateThresholdVisibility();
        }

        // E≈üik deƒüer alanƒ± g√∂r√ºn√ºrl√ºƒü√º
        function updateThresholdVisibility() {
            const thresholdGroup = document.getElementById('thresholdGroup');
            const approvalType = document.getElementById('approvalRequestType').value;

            if (approvalType === 'HYBRID' || approvalType === 'MULTI_LEVEL') {
                thresholdGroup.style.opacity = '1';
                document.getElementById('thresholdValue').required = true;
            } else {
                thresholdGroup.style.opacity = '0.5';
                document.getElementById('thresholdValue').required = false;
            }
        }

        document.getElementById('approvalRequestType').addEventListener('change', updateThresholdVisibility);

        // Form submit
        document.getElementById('preferenceForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const { mode } = getUrlParams();
            const preferenceData = {
                id: document.getElementById('preferenceId').value,
                approvalType: document.getElementById('approvalRequestType').value,
                departmentCode: document.getElementById('departmentCode').value,
                thresholdValue: document.getElementById('thresholdValue').value,
                status: document.getElementById('activeStatus').value,
                validFrom: document.getElementById('validFrom').value
            };

            if (!preferenceData.approvalType || !preferenceData.departmentCode) {
                alert('L√ºtfen zorunlu alanlarƒ± doldurun!\n\n- Budget Onay Talep Tipi\n- Department Kodu');
                return;
            }

            const action = mode === 'create' ? 'olu≈üturuldu' : 'g√ºncellendi';
            alert(`Budget Tercihi ${action}!\n\nTercih ID: ${preferenceData.id}\nDepartment: ${preferenceData.departmentCode}\nOnay Tipi: ${preferenceData.approvalType}\n\n(Backend entegrasyonu ile √ßalƒ±≈üacak)`);

            // Liste sayfasƒ±na d√∂n
            window.location.href = 'budget-preference.html';
        });

        // Sayfa y√ºklendiƒüinde ba≈ülat
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>

    <!-- DEVELOPER DOCUMENTATION PANEL -->
    <div id="devDocsPanel" class="dev-docs-panel">
        <button class="dev-docs-toggle" onclick="toggleDevDocs()">üìã Geli≈ütirici Dok√ºmantasyonu</button>
        <div class="dev-docs-content" id="devDocsContent">
            <div class="dev-docs-header">
                <h2>üìã 15 BP - Budget Preference (Detail)</h2>
                <button class="dev-docs-close" onclick="toggleDevDocs()">‚úï</button>
            </div>
            <div class="dev-docs-body">
                <div class="dev-docs-tabs">
                    <button class="dev-tab active" onclick="showDevTab('dataStructure')">Veri Yapƒ±larƒ±</button>
                    <button class="dev-tab" onclick="showDevTab('businessRules')">ƒ∞≈ü Kurallarƒ±</button>
                </div>
                <div id="dataStructure" class="dev-tab-content active">
                    <h3>Budget Preference Tablosu</h3>
                    <table class="dev-table"><thead><tr><th>Field Name</th><th>Type</th><th>Length</th><th>Description</th></tr></thead>
                        <tbody>
                            <tr><td>Budget Preference Id</td><td>int</td><td>8</td><td>Primary key</td></tr>
                            <tr><td>Budget Approval request Type</td><td>char</td><td>1</td><td>Onay tipi kodu (1-6)</td></tr>
                            <tr><td>Department code</td><td>text</td><td>8</td><td>Departman kodu (unique)</td></tr>
                        </tbody>
                    </table>
                    <h3>Budget Approval Request Types</h3>
                    <table class="dev-table"><thead><tr><th>Kod</th><th>Tip Adƒ±</th><th>A√ßƒ±klama</th></tr></thead>
                        <tbody>
                            <tr><td>1</td><td>SL Approval</td><td>Her talep i√ßin SL onayƒ±</td></tr>
                            <tr><td>2</td><td>SL over budget approval</td><td>Sadece b√ºt√ße a≈üƒ±mƒ±nda SL onayƒ±</td></tr>
                            <tr><td>3</td><td>Manager approval</td><td>Her talep i√ßin y√∂netici onayƒ±</td></tr>
                            <tr><td>4</td><td>Manager Over budget Approval</td><td>Sadece b√ºt√ße a≈üƒ±mƒ±nda y√∂netici</td></tr>
                            <tr><td>5</td><td>Only TL and above</td><td>Sadece TL ve √ºst√º talep yapabilir</td></tr>
                            <tr><td>6</td><td>Not required</td><td>B√ºt√ße onayƒ± gerekmez</td></tr>
                        </tbody>
                    </table>
                </div>
                <div id="businessRules" class="dev-tab-content">
                    <h3>ƒ∞≈ü Kurallarƒ±</h3>
                    <div class="rules-section">
                        <ul>
                            <li>Her departman i√ßin <strong>tek bir preference</strong> olabilir</li>
                            <li>Department code benzersiz olmalƒ± (unique)</li>
                            <li>Approval Type departmanƒ±n t√ºm talep akƒ±≈ülarƒ±nƒ± belirler</li>
                            <li>Ge√ßerlilik ba≈ülangƒ±√ß tarihi belirlenebilir</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <style>
        .dev-docs-panel{position:fixed;bottom:0;left:0;right:0;z-index:9999;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}
        .dev-docs-toggle{position:absolute;bottom:100%;right:20px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border:none;padding:10px 20px;border-radius:8px 8px 0 0;cursor:pointer;font-weight:600;font-size:14px;box-shadow:0 -2px 10px rgba(0,0,0,0.2)}
        .dev-docs-content{display:none;background:#1a1a2e;color:#eee;max-height:60vh;overflow-y:auto;box-shadow:0 -5px 20px rgba(0,0,0,0.3)}
        .dev-docs-content.active{display:block}
        .dev-docs-header{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);position:sticky;top:0}
        .dev-docs-header h2{margin:0;font-size:18px}
        .dev-docs-close{background:rgba(255,255,255,0.2);border:none;color:#fff;width:30px;height:30px;border-radius:50%;cursor:pointer;font-size:16px}
        .dev-docs-body{padding:20px}
        .dev-docs-tabs{display:flex;gap:10px;margin-bottom:20px;border-bottom:1px solid #333;padding-bottom:10px}
        .dev-tab{background:#2d2d44;color:#aaa;border:none;padding:10px 20px;border-radius:5px;cursor:pointer;transition:all 0.3s}
        .dev-tab:hover,.dev-tab.active{background:#667eea;color:#fff}
        .dev-tab-content{display:none}
        .dev-tab-content.active{display:block}
        .dev-table{width:100%;border-collapse:collapse;margin:15px 0;font-size:13px}
        .dev-table th,.dev-table td{padding:10px;text-align:left;border:1px solid #333}
        .dev-table th{background:#2d2d44;color:#667eea;font-weight:600}
        .dev-table tr:nth-child(even){background:#252538}
        .dev-docs-body h3{color:#667eea;margin:20px 0 10px;font-size:16px;border-bottom:1px solid #333;padding-bottom:5px}
        .dev-docs-body ul{margin:0 0 15px 20px;line-height:1.8}
        .rules-section{background:#252538;padding:15px;border-radius:8px}
    </style>
    <script>
        function toggleDevDocs(){document.getElementById('devDocsContent').classList.toggle('active')}
        function showDevTab(tabId){document.querySelectorAll('.dev-tab-content').forEach(c=>c.classList.remove('active'));document.querySelectorAll('.dev-tab').forEach(t=>t.classList.remove('active'));document.getElementById(tabId).classList.add('active');event.target.classList.add('active')}
    </script>
</body>
</html>
