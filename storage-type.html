<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Depo Tipi Yonetimi - IMMA</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <nav class="modern-navbar">
        <div class="navbar-container">
            <a href="index.html" class="navbar-brand">
                <div class="navbar-logo">M</div>
                <div class="brand-text">
                    <span class="brand-name">IMMA</span>
                    <span class="brand-subtitle">Endirek Malzeme Yonetimi</span>
                </div>
            </a>
            <ul class="navbar-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <span class="nav-icon">üìä</span>
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="material-list.html" class="nav-link active">
                        <span class="nav-icon">üì¶</span>
                        Ana Veriler
                    </a>
                    <div class="dropdown-menu">
                        <a href="material-list.html" class="dropdown-item">Malzeme Listesi</a>
                        <a href="supplier-list.html" class="dropdown-item">Tedarik√ßi Listesi</a>
                        <a href="storage-type-list.html" class="dropdown-item active">Depo Tipi Listesi</a>
                        <a href="number-series.html" class="dropdown-item">Numara Serileri</a>
                        <a href="material-group.html" class="dropdown-item">Malzeme Gruplarƒ±</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="mrp.html" class="nav-link">
                        <span class="nav-icon">üìà</span>
                        MRP
                    </a>
                </li>
                <li class="nav-item">
                    <a href="srm-list.html" class="nav-link">
                        <span class="nav-icon">üõí</span>
                        Satƒ±nalma
                    </a>
                    <div class="dropdown-menu">
                        <a href="srm-list.html" class="dropdown-item">Talep Listesi</a>
                        <a href="goods-receipt.html" class="dropdown-item">Mal Kabul</a>
                        <a href="po-list.html" class="dropdown-item">Satƒ±nalma Sipari≈üleri</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="budget-management.html" class="nav-link">
                        <span class="nav-icon">üí∞</span>
                        B√ºt√ße
                    </a>
                    <div class="dropdown-menu">
                        <a href="budget-management.html" class="dropdown-item">B√ºt√ße Y√∂netimi</a>
                        <a href="budget-preference.html" class="dropdown-item">B√ºt√ße Tercihleri</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="material-request-list.html" class="nav-link">
                        <span class="nav-icon">üìã</span>
                        Talepler
                    </a>
                    <div class="dropdown-menu">
                        <a href="material-request-list.html" class="dropdown-item">Talep Listesi</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="transfer-list.html" class="nav-link">
                        <span class="nav-icon">üè≠</span>
                        Stok
                    </a>
                    <div class="dropdown-menu">
                        <a href="direct-issue.html" class="dropdown-item">Doƒürudan √áƒ±kƒ±≈ü</a>
                        <a href="warehouse-transfer.html" class="dropdown-item">Depo Transferi</a>
                        <a href="transfer-list.html" class="dropdown-item">Transfer Listesi</a>
                        <a href="inventory-counting.html" class="dropdown-item">Sayƒ±m ƒ∞≈ülemleri</a>
                        <a href="single-material-counting.html" class="dropdown-item">Tekli Malzeme Sayƒ±mƒ±</a>
                        <a href="scrapping.html" class="dropdown-item">Hurda ƒ∞≈ülemleri</a>
                    </div>
                </li>
            </ul>
            <div class="navbar-user">
                <span class="user-name">Ahmet Yilmaz</span>
                <div class="user-avatar">AY</div>
            </div>
        </div>
    </nav>

    <main class="modern-container">
        <div class="page-header">
            <div>
                <h1 class="page-title" id="pageTitle">Yeni Depo Tipi Olu≈ütur</h1>
                <p class="page-subtitle">Ana Veriler > Depo Tipi Y√∂netimi</p>
            </div>
        </div>

        <!-- Developer Notes - Screen Designs IMMA.xlsx "3 STM" -->
        <div class="dev-note info">
            <h4>Ekran Bilgisi: 3 STM - Storage Type Maintenance</h4>
            <p><strong>Ama√ß:</strong> CVCD pattern ile depo tipi verilerinin olu≈üturma, g√∂r√ºnt√ºleme ve d√ºzenleme i≈ülemleri.</p>
            <p><strong>Fonksiyonlar:</strong></p>
            <ul>
                <li>Depo Tipi Olu≈ütur (Create) - URL: ?mode=create</li>
                <li>Depo Tipi G√∂r√ºnt√ºle (View) - URL: ?id=xxx&mode=view</li>
                <li>Depo Tipi D√ºzenle (Change/Edit) - URL: ?id=xxx&mode=edit</li>
            </ul>
            <p><strong>Excel Spec:</strong> Screen Designs IMMA.xlsx - "3 STM"</p>
            <p><strong>Not:</strong> Liste g√∂r√ºn√ºm√º storage-type-list.html sayfasƒ±ndadƒ±r.</p>
        </div>

        <!-- STORAGE FORM - Data Structure IMMA.xlsx "Storage Type" sheet -->
        <div class="card">
            <div class="card-header">
                <h3 id="formTitle">Yeni Depo Tipi Olu≈ütur</h3>
            </div>
            <div class="card-body">
                <!-- Row 1: Depo Tipi ID, Depo Tipi -->
                <div class="form-row">
                    <div class="form-group col-3">
                        <label>Depo Tipi ID</label>
                        <input type="text" class="form-control" id="storageTypeId" readonly placeholder="Otomatik olu≈üturulur">
                        <small class="form-hint">Sistem otomatik olu≈üturur</small>
                    </div>
                    <div class="form-group col-3">
                        <label>Depo Tipi <span class="required">*</span></label>
                        <select class="form-control" id="storageType" required>
                            <option value="">Se√ßiniz...</option>
                            <option value="1">1 - Depo</option>
                            <option value="2">2 - Lokasyon</option>
                            <option value="3">3 - Raf</option>
                        </select>
                        <input type="text" class="form-control" id="storageTypeText" readonly style="display: none;">
                        <small class="form-hint">char(1): 1=Depo, 2=Lokasyon, 3=Raf</small>
                    </div>
                </div>

                <!-- Row 2: Depo Kodu, Depo Adƒ± -->
                <div class="form-row">
                    <div class="form-group col-3">
                        <label>Depo Kodu <span class="required">*</span></label>
                        <input type="text" class="form-control" id="storageCode" maxlength="12" placeholder="Max 12 karakter" required>
                        <small class="form-hint">Text(12)</small>
                    </div>
                    <div class="form-group col-6">
                        <label>Depo Adƒ± <span class="required">*</span></label>
                        <input type="text" class="form-control" id="storageTitle" maxlength="16" placeholder="Max 16 karakter" required>
                        <small class="form-hint">text(16)</small>
                    </div>
                </div>

                <!-- Row 3: ƒ∞li≈ükili Lokasyon Kodu, Varsayƒ±lan Alt Depo Tipi Kodu -->
                <div class="form-row">
                    <div class="form-group col-3">
                        <label>ƒ∞li≈ükili Lokasyon Kodu</label>
                        <input type="text" class="form-control" id="relatedLocationCode" maxlength="12" placeholder="Max 12 karakter">
                        <small class="form-hint">Text(12)</small>
                    </div>
                    <div class="form-group col-3">
                        <label>Varsayƒ±lan Alt Depo Tipi Kodu</label>
                        <input type="text" class="form-control" id="defaultSubStorageTypeCode" maxlength="12" placeholder="Max 12 karakter">
                        <small class="form-hint">Text(12)</small>
                    </div>
                </div>

                <hr style="margin: 20px 0;">

                <!-- Row 4: Olu≈üturan Kullanƒ±cƒ±, Olu≈üturma Tarihi -->
                <div class="form-row">
                    <div class="form-group col-6">
                        <label>Olu≈üturan Kullanƒ±cƒ±</label>
                        <input type="text" class="form-control" id="createdByUserInfo" readonly value="-">
                        <small class="form-hint">int(8)</small>
                    </div>
                    <div class="form-group col-3">
                        <label>Olu≈üturma Tarihi</label>
                        <input type="text" class="form-control" id="creationDateTime" readonly value="-">
                        <small class="form-hint">datetime</small>
                    </div>
                </div>

                <hr style="margin: 20px 0;">

                <!-- Row 5: Pasif Checkbox -->
                <div class="form-row">
                    <div class="form-group col-3">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="inactivationCheckBox" style="width: 18px; height: 18px;">
                            <label for="inactivationCheckBox" style="margin: 0;">Pasif Yap</label>
                        </div>
                        <small class="form-hint">bool</small>
                    </div>
                </div>

                <!-- Row 6: Pasif Yapan Kullanƒ±cƒ±, Pasif Yapma Tarihi -->
                <div class="form-row">
                    <div class="form-group col-6">
                        <label>Pasif Yapan Kullanƒ±cƒ±</label>
                        <input type="text" class="form-control" id="inactivatedByUserInfo" readonly value="-">
                        <small class="form-hint">int(8)</small>
                    </div>
                    <div class="form-group col-3">
                        <label>Pasif Yapma Tarihi</label>
                        <input type="text" class="form-control" id="inactivationDateTime" readonly value="-">
                        <small class="form-hint">datetime</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Action Buttons -->
        <div class="form-actions" style="margin-top: 20px;">
            <button class="btn btn-primary" id="saveBtn">
                Kaydet
            </button>
            <button class="btn btn-primary" id="editBtn" style="display: none;">
                D√ºzenle
            </button>
            <button class="btn btn-secondary" id="cancelBtn" onclick="window.location.href='storage-type-list.html'">
                ƒ∞ptal
            </button>
        </div>

        <!-- Veritabanƒ± ƒ∞≈ülemleri - Data Structure IMMA.xlsx "Storage Type" sheet -->
        <div class="dev-note success">
            <h4>‚úÖ Veritabanƒ± ƒ∞≈ülemleri (Data Structure IMMA.xlsx - "Storage Type" sheet)</h4>
            <p><strong>API Endpoints:</strong></p>
            <ul>
                <li>POST /api/storage-types - Yeni depo tipi olu≈ütur</li>
                <li>PUT /api/storage-types/{id} - Depo tipi g√ºncelle</li>
                <li>GET /api/storage-types/{id} - Depo tipi detay g√∂r√ºnt√ºle</li>
            </ul>
            <p><strong>Kayƒ±t Tablosu:</strong></p>
            <ol>
                <li><strong>Storage</strong> - Depo tipi kaydƒ±</li>
            </ol>
            <p><strong>Storage Tablo Alanlarƒ± (Data Structure IMMA.xlsx):</strong></p>
            <ul>
                <li>Storage type Id - Sistem otomatik olu≈üturur</li>
                <li>Storage type (char, 1) - Depo tipi kodu</li>
                <li>Storage Code (Text, 12) - Depo kodu</li>
                <li>Storage Title (text, 16) - Depo adƒ±</li>
                <li>Created By user info (int, 8) - Olu≈üturan kullanƒ±cƒ± ID</li>
                <li>Creation date time (datetime) - Olu≈üturma zamanƒ±</li>
                <li>Inactivation check box (bool) - Pasif checkbox</li>
                <li>Inactivation date time (datetime) - Pasif yapma zamanƒ±</li>
                <li>Inactivated by user info (int, 8) - Pasif yapan kullanƒ±cƒ± ID</li>
                <li>Related Location Code (Text, 12) - ƒ∞li≈ükili lokasyon kodu</li>
                <li>Default sub storage type code (Text, 12) - Varsayƒ±lan alt depo tipi kodu</li>
            </ul>
            <p><strong>Storage Types (Data Structure IMMA.xlsx):</strong></p>
            <ul>
                <li>1 = Storage (Depo)</li>
                <li>2 = Location (Lokasyon)</li>
                <li>3 = Bin (Raf)</li>
            </ul>
        </div>
    </main>

    <script>
        // CVCD Pattern Implementation - Storage Type Management
        // Based on Data Structure IMMA.xlsx - "Storage Type" sheet
        // Storage table fields: Storage type Id, Storage type, Storage Code, Storage Title,
        // Created By user info, Creation date time, Inactivation check box,
        // Inactivation date time, Inactivated by user info, Related Location Code,
        // Default sub storage type code

        // Demo storage data (simulating database - Storage table)
        // Storage type values per Data Structure IMMA.xlsx:
        // 1 = Storage (Depo)
        // 2 = Location (Lokasyon)
        // 3 = Bin (Raf)
        const storageData = [
            {
                storageTypeId: '1',
                storageType: '1',
                storageCode: 'MERKEZ',
                storageTitle: 'Merkez Depo',
                createdByUserInfo: 'Fatma ≈ûahin - Depo Sorumlusu',
                creationDateTime: '10.11.2025 14:30',
                inactivationCheckBox: false,
                inactivationDateTime: '-',
                inactivatedByUserInfo: '-',
                relatedLocationCode: '',
                defaultSubStorageTypeCode: 'LOC-001'
            },
            {
                storageTypeId: '2',
                storageType: '2',
                storageCode: 'LOC-001',
                storageTitle: 'A Blok 1. Kat',
                createdByUserInfo: 'Fatma ≈ûahin - Depo Sorumlusu',
                creationDateTime: '10.11.2025 15:00',
                inactivationCheckBox: false,
                inactivationDateTime: '-',
                inactivatedByUserInfo: '-',
                relatedLocationCode: 'MERKEZ',
                defaultSubStorageTypeCode: 'BIN-001'
            },
            {
                storageTypeId: '3',
                storageType: '3',
                storageCode: 'BIN-001',
                storageTitle: 'A01-R01-K01',
                createdByUserInfo: 'Fatma ≈ûahin - Depo Sorumlusu',
                creationDateTime: '10.11.2025 15:30',
                inactivationCheckBox: false,
                inactivationDateTime: '-',
                inactivatedByUserInfo: '-',
                relatedLocationCode: 'LOC-001',
                defaultSubStorageTypeCode: ''
            }
        ];

        let currentMode = 'create'; // create, edit, view
        let currentId = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Parse URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const mode = urlParams.get('mode') || 'create';
            const id = urlParams.get('id');

            currentMode = mode;
            currentId = id;

            // Initialize based on mode
            if (mode === 'create') {
                initCreateMode();
            } else if (mode === 'edit' && id) {
                initEditMode(id);
            } else if (mode === 'view' && id) {
                initViewMode(id);
            } else {
                // Default to create mode
                initCreateMode();
            }
        });

        // Initialize CREATE mode
        function initCreateMode() {
            currentMode = 'create';
            currentId = null;

            // Update titles
            document.getElementById('pageTitle').textContent = 'Yeni Depo Tipi Olu≈ütur';
            document.getElementById('formTitle').textContent = 'Yeni Depo Tipi Olu≈ütur';

            // Enable all fields
            enableForm();

            // Clear form
            clearForm();

            // Show save button, hide edit button
            document.getElementById('saveBtn').style.display = 'inline-block';
            document.getElementById('saveBtn').textContent = 'Kaydet';
            document.getElementById('editBtn').style.display = 'none';
            document.getElementById('cancelBtn').textContent = 'ƒ∞ptal';
        }

        // Initialize EDIT mode
        function initEditMode(storageId) {
            currentMode = 'edit';
            currentId = storageId;

            // Find storage
            const storage = storageData.find(s => s.storageTypeId === storageId);
            if (!storage) {
                alert('Depo tipi bulunamadƒ±!');
                window.location.href = 'storage-type-list.html';
                return;
            }

            // Update titles
            document.getElementById('pageTitle').textContent = `Depo Tipi D√ºzenle: ${storage.storageTitle}`;
            document.getElementById('formTitle').textContent = `Depo Tipi D√ºzenle: ${storage.storageTitle}`;

            // Enable form
            enableForm();

            // Fill form with data
            fillForm(storage);

            // Show save button, hide edit button
            document.getElementById('saveBtn').style.display = 'inline-block';
            document.getElementById('saveBtn').textContent = 'Kaydet';
            document.getElementById('editBtn').style.display = 'none';
            document.getElementById('cancelBtn').textContent = 'ƒ∞ptal';
        }

        // Initialize VIEW mode
        function initViewMode(storageId) {
            currentMode = 'view';
            currentId = storageId;

            // Find storage
            const storage = storageData.find(s => s.storageTypeId === storageId);
            if (!storage) {
                alert('Depo tipi bulunamadƒ±!');
                window.location.href = 'storage-type-list.html';
                return;
            }

            // Update titles
            document.getElementById('pageTitle').textContent = `Depo Tipi Detay: ${storage.storageTitle}`;
            document.getElementById('formTitle').textContent = `Depo Tipi Detay: ${storage.storageTitle}`;

            // Fill form with data
            fillForm(storage);

            // Disable all fields (read-only)
            disableForm();

            // Show storage type as text instead of dropdown in view mode
            document.getElementById('storageType').style.display = 'none';
            document.getElementById('storageTypeText').style.display = 'block';
            document.getElementById('storageTypeText').value = getStorageTypeTitle(storage.storageType);

            // Hide save button, show edit button
            document.getElementById('saveBtn').style.display = 'none';
            document.getElementById('editBtn').style.display = 'inline-block';

            // Update cancel button text
            document.getElementById('cancelBtn').textContent = 'Listeye D√∂n';
        }

        // Fill form with storage data
        function fillForm(storage) {
            document.getElementById('storageTypeId').value = storage.storageTypeId;
            document.getElementById('storageType').value = storage.storageType;
            document.getElementById('storageCode').value = storage.storageCode;
            document.getElementById('storageTitle').value = storage.storageTitle;
            document.getElementById('relatedLocationCode').value = storage.relatedLocationCode;
            document.getElementById('defaultSubStorageTypeCode').value = storage.defaultSubStorageTypeCode;
            document.getElementById('createdByUserInfo').value = storage.createdByUserInfo;
            document.getElementById('creationDateTime').value = storage.creationDateTime;
            document.getElementById('inactivationCheckBox').checked = storage.inactivationCheckBox;
            document.getElementById('inactivatedByUserInfo').value = storage.inactivatedByUserInfo;
            document.getElementById('inactivationDateTime').value = storage.inactivationDateTime;
        }

        // Clear form
        function clearForm() {
            document.getElementById('storageTypeId').value = '';
            document.getElementById('storageType').value = '';
            document.getElementById('storageCode').value = '';
            document.getElementById('storageTitle').value = '';
            document.getElementById('relatedLocationCode').value = '';
            document.getElementById('defaultSubStorageTypeCode').value = '';
            document.getElementById('createdByUserInfo').value = '-';
            document.getElementById('creationDateTime').value = '-';
            document.getElementById('inactivationCheckBox').checked = false;
            document.getElementById('inactivatedByUserInfo').value = '-';
            document.getElementById('inactivationDateTime').value = '-';
        }

        // Enable form fields
        function enableForm() {
            document.querySelectorAll('.form-control').forEach(input => {
                if (input.id !== 'storageTypeId' && input.id !== 'createdByUserInfo' &&
                    input.id !== 'creationDateTime' && input.id !== 'inactivatedByUserInfo' &&
                    input.id !== 'inactivationDateTime') {
                    input.disabled = false;
                }
            });
            document.getElementById('inactivationCheckBox').disabled = false;

            // Show dropdown, hide text display for storage type
            document.getElementById('storageType').style.display = 'block';
            document.getElementById('storageTypeText').style.display = 'none';
        }

        // Disable form fields (read-only mode)
        function disableForm() {
            document.querySelectorAll('.form-control').forEach(input => {
                input.disabled = true;
            });
            document.getElementById('inactivationCheckBox').disabled = true;
        }

        // Get storage type title from value
        // Per Data Structure IMMA.xlsx - Storage Types:
        // 1 = Storage (Depo), 2 = Location (Lokasyon), 3 = Bin (Raf)
        function getStorageTypeTitle(typeValue) {
            const typeMap = {
                '1': '1 - Depo',
                '2': '2 - Lokasyon',
                '3': '3 - Raf'
            };
            return typeMap[typeValue] || '';
        }

        // Inactivation checkbox change handler
        document.getElementById('inactivationCheckBox').addEventListener('change', function() {
            if (this.checked) {
                const currentUser = 'Ahmet Yƒ±lmaz - Sistem Admin';
                const currentDate = new Date().toLocaleString('tr-TR');
                document.getElementById('inactivatedByUserInfo').value = currentUser;
                document.getElementById('inactivationDateTime').value = currentDate;
            } else {
                document.getElementById('inactivatedByUserInfo').value = '-';
                document.getElementById('inactivationDateTime').value = '-';
            }
        });

        // Edit button handler - switches from view mode to edit mode
        document.getElementById('editBtn').addEventListener('click', function() {
            if (currentId) {
                window.location.href = `storage-type.html?id=${currentId}&mode=edit`;
            }
        });

        // Save button handler
        document.getElementById('saveBtn').addEventListener('click', function() {
            // Get form values
            const storageType = document.getElementById('storageType').value;
            const storageCode = document.getElementById('storageCode').value.trim();
            const storageTitle = document.getElementById('storageTitle').value.trim();
            const relatedLocationCode = document.getElementById('relatedLocationCode').value.trim();
            const defaultSubStorageTypeCode = document.getElementById('defaultSubStorageTypeCode').value.trim();

            // Validation
            if (!storageType) {
                alert('Depo Tipi zorunlu alandƒ±r.');
                document.getElementById('storageType').focus();
                return;
            }
            if (!storageCode) {
                alert('Depo Kodu zorunlu alandƒ±r.');
                document.getElementById('storageCode').focus();
                return;
            }
            if (!storageTitle) {
                alert('Depo Adƒ± zorunlu alandƒ±r.');
                document.getElementById('storageTitle').focus();
                return;
            }

            const storageTypeTitle = getStorageTypeTitle(storageType);

            // Determine action
            if (currentMode === 'create') {
                // Create new storage
                if (confirm(`Yeni depo tipi olu≈üturulacak:\n\nDepo Tipi: ${storageTypeTitle}\nDepo Kodu: ${storageCode}\nDepo Adƒ±: ${storageTitle}\n\nDevam etmek istiyor musunuz?`)) {
                    // In real app: POST /api/storage-types
                    alert(`Depo tipi ba≈üarƒ±yla olu≈üturuldu!\n\nDepo Tipi: ${storageTypeTitle}\nDepo Kodu: ${storageCode}\nDepo Adƒ±: ${storageTitle}`);

                    // Redirect to list
                    window.location.href = 'storage-type-list.html';
                }
            } else if (currentMode === 'edit') {
                // Update existing storage
                if (confirm(`Depo tipi g√ºncellenecek:\n\nID: ${currentId}\nDepo Tipi: ${storageTypeTitle}\nDepo Kodu: ${storageCode}\nDepo Adƒ±: ${storageTitle}\n\nDevam etmek istiyor musunuz?`)) {
                    // In real app: PUT /api/storage-types/{id}
                    alert(`Depo tipi ba≈üarƒ±yla g√ºncellendi!\n\nID: ${currentId}\nDepo Tipi: ${storageTypeTitle}\nDepo Kodu: ${storageCode}\nDepo Adƒ±: ${storageTitle}`);

                    // Redirect to list
                    window.location.href = 'storage-type-list.html';
                }
            }
        });
    </script>
</body>
</html>
