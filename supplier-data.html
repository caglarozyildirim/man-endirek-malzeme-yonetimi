<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TedarikÃ§i YÃ¶netimi - IMMA</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- NAVBAR - Top Navigation (Maximo Style) -->
    <nav class="modern-navbar">
        <div class="navbar-container">
            <a href="index.html" class="navbar-brand">
                <div class="navbar-logo">M</div>
                <div class="brand-text">
                    <span class="brand-name">IMMA</span>
                    <span class="brand-subtitle">Endirek Malzeme YÃ¶netimi</span>
                </div>
            </a>
            <ul class="navbar-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <span class="nav-icon">ğŸ“Š</span>
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="material-list.html" class="nav-link active">
                        <span class="nav-icon">ğŸ“¦</span>
                        Ana Veriler
                    </a>
                    <div class="dropdown-menu">
                        <a href="material-list.html" class="dropdown-item">Malzeme Listesi</a>
                        <a href="supplier-list.html" class="dropdown-item active">TedarikÃ§i Listesi</a>
                        <a href="storage-type-list.html" class="dropdown-item">Depo Tipi Listesi</a>
                        <a href="number-series.html" class="dropdown-item">Numara Serileri</a>
                        <a href="material-group.html" class="dropdown-item">Malzeme GruplarÄ±</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="mrp.html" class="nav-link">
                        <span class="nav-icon">ğŸ“ˆ</span>
                        MRP
                    </a>
                </li>
                <li class="nav-item">
                    <a href="srm-list.html" class="nav-link">
                        <span class="nav-icon">ğŸ›’</span>
                        SatÄ±nalma
                    </a>
                    <div class="dropdown-menu">
                        <a href="srm-list.html" class="dropdown-item">Talep Listesi</a>
                        <a href="goods-receipt.html" class="dropdown-item">Mal Kabul</a>
                        <a href="po-list.html" class="dropdown-item">SatÄ±nalma SipariÅŸleri</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="budget-management.html" class="nav-link">
                        <span class="nav-icon">ğŸ’°</span>
                        BÃ¼tÃ§e
                    </a>
                    <div class="dropdown-menu">
                        <a href="budget-management.html" class="dropdown-item">BÃ¼tÃ§e YÃ¶netimi</a>
                        <a href="budget-preference.html" class="dropdown-item">BÃ¼tÃ§e Tercihleri</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="material-request-list.html" class="nav-link">
                        <span class="nav-icon">ğŸ“‹</span>
                        Talepler
                    </a>
                    <div class="dropdown-menu">
                        <a href="material-request-list.html" class="dropdown-item">Talep Listesi</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="transfer-list.html" class="nav-link">
                        <span class="nav-icon">ğŸ­</span>
                        Stok
                    </a>
                    <div class="dropdown-menu">
                        <a href="direct-issue.html" class="dropdown-item">DoÄŸrudan Ã‡Ä±kÄ±ÅŸ</a>
                        <a href="warehouse-transfer.html" class="dropdown-item">Depo Transferi</a>
                        <a href="transfer-list.html" class="dropdown-item">Transfer Listesi</a>
                        <a href="inventory-counting.html" class="dropdown-item">SayÄ±m Ä°ÅŸlemleri</a>
                        <a href="single-material-counting.html" class="dropdown-item">Tekli Malzeme SayÄ±mÄ±</a>
                        <a href="scrapping.html" class="dropdown-item">Hurda Ä°ÅŸlemleri</a>
                    </div>
                </li>
            </ul>
            <div class="navbar-user">
                <span class="user-name">Ahmet YÄ±lmaz</span>
                <div class="user-avatar">AY</div>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="modern-container">
        <div class="page-header">
            <div>
                <h1 class="page-title" id="pageTitle">Yeni TedarikÃ§i OluÅŸtur</h1>
                <p class="page-subtitle">Ana Veriler > TedarikÃ§i YÃ¶netimi</p>
            </div>
        </div>

        <!-- Developer Notes -->
        <div class="dev-note info">
            <h4>Ekran Bilgisi: 7 MS - Maintain Supplier</h4>
            <p><strong>AmaÃ§:</strong> CVCD pattern ile tedarikÃ§i verilerinin oluÅŸturma, gÃ¶rÃ¼ntÃ¼leme ve dÃ¼zenleme iÅŸlemleri.</p>
            <p><strong>Fonksiyonlar:</strong></p>
            <ul>
                <li>TedarikÃ§i OluÅŸtur (Create) - URL: ?mode=create</li>
                <li>TedarikÃ§i GÃ¶rÃ¼ntÃ¼le (View) - URL: ?id=xxx&mode=view</li>
                <li>TedarikÃ§i DÃ¼zenle (Change/Edit) - URL: ?id=xxx&mode=edit</li>
            </ul>
            <p><strong>Excel Spec:</strong> "7 MS - Maintain Supplier"</p>
            <p><strong>Not:</strong> Liste gÃ¶rÃ¼nÃ¼mÃ¼ supplier-list.html sayfasÄ±ndadÄ±r.</p>
        </div>

        <!-- CREATE/EDIT/VIEW FORM SECTION -->
        <div class="card">
            <div class="card-header">
                <h3 id="formTitle">Yeni TedarikÃ§i OluÅŸtur</h3>
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group col-3">
                        <label>TedarikÃ§i ID</label>
                        <input type="text" class="form-control" id="supplierId" readonly>
                        <small class="form-hint">Otomatik oluÅŸturulur</small>
                    </div>
                    <div class="form-group col-3">
                        <label>SAP TedarikÃ§i No <span class="required">*</span></label>
                        <input type="text" class="form-control" id="supplierSapNo" maxlength="10" placeholder="1000012345">
                    </div>
                    <div class="form-group col-6">
                        <label>TedarikÃ§i ÃœnvanÄ± 1 <span class="required">*</span></label>
                        <input type="text" class="form-control" id="supplierTitle1" maxlength="50" placeholder="TedarikÃ§i ticari Ã¼nvanÄ±">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-6">
                        <label>TedarikÃ§i ÃœnvanÄ± 2</label>
                        <input type="text" class="form-control" id="supplierTitle2" maxlength="50" placeholder="Åube veya ek bilgi (opsiyonel)">
                    </div>
                    <div class="form-group col-3">
                        <label>TedarikÃ§i Durumu <span class="required">*</span></label>
                        <!-- Dropdown for create/edit mode -->
                        <select class="form-control" id="supplierStatusNo">
                            <option value="">SeÃ§iniz...</option>
                            <option value="1">Aktif</option>
                            <option value="2">Diskalifiye</option>
                            <option value="3">Pasif</option>
                        </select>
                        <!-- Input display for view mode -->
                        <input type="text" class="form-control" id="supplierStatusText" readonly style="display: none;">
                    </div>
                    <div class="form-group col-3">
                        <label>Ortalama Teslim SÃ¼resi (Ä°ÅŸ GÃ¼nÃ¼)</label>
                        <input type="number" class="form-control" id="avgDeliveryTime" min="0" placeholder="7">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-6">
                        <label>OluÅŸturan</label>
                        <input type="text" class="form-control" id="createdBy" readonly value="-">
                    </div>
                    <div class="form-group col-6">
                        <label>OluÅŸturma Tarihi</label>
                        <input type="text" class="form-control" id="creationDate" readonly value="-">
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Action Buttons -->
        <div class="form-actions" style="margin-top: 20px;">
            <button class="btn btn-primary" id="saveBtn">
                Kaydet
            </button>
            <button class="btn btn-secondary" id="cancelBtn" onclick="window.location.href='supplier-list.html'">
                Ä°ptal
            </button>
        </div>

        <!-- Database Operations - Data Structure IMMA.xlsx -->
        <div class="dev-note success">
            <h4>âœ… VeritabanÄ± Ä°ÅŸlemleri (Data Structure IMMA.xlsx)</h4>
            <p><strong>API Endpoints:</strong></p>
            <ul>
                <li>POST /api/suppliers - Yeni tedarikÃ§i oluÅŸtur</li>
                <li>PUT /api/suppliers/{id} - TedarikÃ§i gÃ¼ncelle</li>
                <li>GET /api/suppliers/{id} - TedarikÃ§i detay gÃ¶rÃ¼ntÃ¼le</li>
            </ul>
            <p><strong>KayÄ±t TablolarÄ± (Data Structure IMMA.xlsx - "Supplier" sheet):</strong></p>
            <ol>
                <li><strong>Supplier</strong> - Ana tedarikÃ§i kaydÄ±</li>
            </ol>
            <p><strong>Supplier Tablo AlanlarÄ±:</strong></p>
            <ul>
                <li>Supplier Id (int, 8) - Sistem otomatik oluÅŸturur</li>
                <li>Supplier SAP no (int, 10) - KullanÄ±cÄ± giriÅŸi (zorunlu)</li>
                <li>Supplier title 1 (text, 50) - Ana Ã¼nvan (zorunlu)</li>
                <li>Supplier title 2 (text, 50) - Ek Ã¼nvan (opsiyonel)</li>
                <li>Supplier status id (char, 1) - Durum kodu</li>
                <li>Average delivery time as business days (int, 4) - Ä°ÅŸ gÃ¼nÃ¼ cinsinden</li>
                <li>Created by user info (int, 8) - OluÅŸturan kullanÄ±cÄ± ID</li>
                <li>Creation date time (datetime) - OluÅŸturma zamanÄ±</li>
            </ul>
            <p><strong>Supplier Status Tablosu (Data Structure IMMA.xlsx - "Supplier Status" sheet):</strong></p>
            <ul>
                <li>1 = Active (Aktif)</li>
                <li>2 = Disqualified (Diskalifiye)</li>
                <li>3 = Inactive (Pasif)</li>
            </ul>
        </div>
    </main>

    <script>
        // CVCD Pattern Implementation - Supplier Data Management
        // Based on Excel spec: "7 MS - Maintain Supplier"
        // Form-only page for Create/View/Edit modes
        // List functionality is in supplier-list.html

        // Demo supplier data (simulating database - MD_Supplier table)
        // IDs match supplier-list.html
        // Status values per Data Structure IMMA.xlsx - Supplier Status:
        // 1 = Active (Aktif)
        // 2 = Disqualified (Diskalifiye)
        // 3 = Inactive (Pasif)
        const suppliersData = [
            {
                supplierId: 'SUP-00001',
                supplierSapNo: '10001234',
                supplierTitle1: 'ABC Rulman San. Tic. Ltd. Åti.',
                supplierTitle2: 'ABC Bearings Industrial',
                supplierStatusNo: '1',
                supplierStatusTitle: 'Aktif',
                avgDeliveryTime: 5,
                createdBy: 'Fatma Åahin - SatÄ±n Alma UzmanÄ±',
                creationDate: '10.12.2025 09:00'
            },
            {
                supplierId: 'SUP-00002',
                supplierSapNo: '10001235',
                supplierTitle1: 'XYZ Elektrik Malzemeleri A.Å.',
                supplierTitle2: 'XYZ Electrical Supplies Inc.',
                supplierStatusNo: '1',
                supplierStatusTitle: 'Aktif',
                avgDeliveryTime: 7,
                createdBy: 'Mehmet YÄ±lmaz - SatÄ±n Alma MÃ¼dÃ¼rÃ¼',
                creationDate: '08.12.2025 14:30'
            },
            {
                supplierId: 'SUP-00003',
                supplierSapNo: '10001236',
                supplierTitle1: 'German Bearings GmbH',
                supplierTitle2: 'Deutsche Lager Vertrieb',
                supplierStatusNo: '1',
                supplierStatusTitle: 'Aktif',
                avgDeliveryTime: 14,
                createdBy: 'AyÅŸe Demir - SatÄ±n Alma UzmanÄ±',
                creationDate: '05.12.2025 11:20'
            },
            {
                supplierId: 'SUP-00004',
                supplierSapNo: '10001237',
                supplierTitle1: 'Konsinye Yedek ParÃ§a Ltd.',
                supplierTitle2: 'Consignment Spare Parts',
                supplierStatusNo: '1',
                supplierStatusTitle: 'Aktif',
                avgDeliveryTime: 3,
                createdBy: 'Ali Kaya - SatÄ±n Alma MÃ¼dÃ¼rÃ¼',
                creationDate: '01.12.2025 16:45'
            },
            {
                supplierId: 'SUP-00005',
                supplierSapNo: '10001238',
                supplierTitle1: 'Pasif TedarikÃ§i A.Å.',
                supplierTitle2: 'Inactive Supplier Corp.',
                supplierStatusNo: '3',
                supplierStatusTitle: 'Pasif',
                avgDeliveryTime: 10,
                createdBy: 'Fatma Åahin - SatÄ±n Alma UzmanÄ±',
                creationDate: '28.11.2025 10:00'
            },
            {
                supplierId: 'SUP-00006',
                supplierSapNo: '10001239',
                supplierTitle1: 'Diskalifiye TedarikÃ§i San. Ltd.',
                supplierTitle2: 'Disqualified Supplier Industries',
                supplierStatusNo: '2',
                supplierStatusTitle: 'Diskalifiye',
                avgDeliveryTime: 0,
                createdBy: 'Mehmet YÄ±lmaz - SatÄ±n Alma MÃ¼dÃ¼rÃ¼',
                creationDate: '25.11.2025 09:15'
            }
        ];

        let currentMode = 'create'; // create, edit, view
        let currentSupplierId = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Parse URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const mode = urlParams.get('mode') || 'create';
            const id = urlParams.get('id');

            currentMode = mode;
            currentSupplierId = id;

            // Initialize based on mode
            if (mode === 'create') {
                initCreateMode();
            } else if (mode === 'edit' && id) {
                initEditMode(id);
            } else if (mode === 'view' && id) {
                initViewMode(id);
            } else {
                // Default to create mode
                initCreateMode();
            }
        });

        // Initialize CREATE mode
        function initCreateMode() {
            currentMode = 'create';
            currentSupplierId = null;

            // Update titles
            document.getElementById('pageTitle').textContent = 'Yeni TedarikÃ§i OluÅŸtur';
            document.getElementById('formTitle').textContent = 'Yeni TedarikÃ§i OluÅŸtur';

            // Enable all fields
            enableForm();

            // Clear form
            clearForm();

            // Show save button
            document.getElementById('saveBtn').style.display = 'inline-block';
            document.getElementById('saveBtn').textContent = 'Kaydet';
        }

        // Initialize EDIT mode
        function initEditMode(supplierId) {
            currentMode = 'edit';
            currentSupplierId = supplierId;

            // Find supplier
            const supplier = suppliersData.find(s => s.supplierId === supplierId);
            if (!supplier) {
                alert('TedarikÃ§i bulunamadÄ±!');
                window.location.href = 'supplier-list.html';
                return;
            }

            // Update titles
            document.getElementById('pageTitle').textContent = `TedarikÃ§i DÃ¼zenle: ${supplier.supplierTitle1}`;
            document.getElementById('formTitle').textContent = `TedarikÃ§i DÃ¼zenle: ${supplier.supplierTitle1}`;

            // Enable form (except ID field)
            enableForm();
            document.getElementById('supplierId').disabled = true;

            // Fill form with data
            fillForm(supplier);

            // Show save button
            document.getElementById('saveBtn').style.display = 'inline-block';
            document.getElementById('saveBtn').textContent = 'Kaydet';
        }

        // Initialize VIEW mode
        function initViewMode(supplierId) {
            currentMode = 'view';
            currentSupplierId = supplierId;

            // Find supplier
            const supplier = suppliersData.find(s => s.supplierId === supplierId);
            if (!supplier) {
                alert('TedarikÃ§i bulunamadÄ±!');
                window.location.href = 'supplier-list.html';
                return;
            }

            // Update titles
            document.getElementById('pageTitle').textContent = `TedarikÃ§i Detay: ${supplier.supplierTitle1}`;
            document.getElementById('formTitle').textContent = `TedarikÃ§i Detay: ${supplier.supplierTitle1}`;

            // Fill form with data
            fillForm(supplier);

            // Disable all fields (read-only)
            disableForm();

            // Show status as text instead of dropdown in view mode
            document.getElementById('supplierStatusNo').style.display = 'none';
            document.getElementById('supplierStatusText').style.display = 'block';
            document.getElementById('supplierStatusText').value = supplier.supplierStatusTitle;

            // Hide save button
            document.getElementById('saveBtn').style.display = 'none';
        }

        // Fill form with supplier data
        function fillForm(supplier) {
            document.getElementById('supplierId').value = supplier.supplierId;
            document.getElementById('supplierSapNo').value = supplier.supplierSapNo;
            document.getElementById('supplierTitle1').value = supplier.supplierTitle1;
            document.getElementById('supplierTitle2').value = supplier.supplierTitle2;
            document.getElementById('supplierStatusNo').value = supplier.supplierStatusNo;
            document.getElementById('avgDeliveryTime').value = supplier.avgDeliveryTime;
            document.getElementById('createdBy').value = supplier.createdBy;
            document.getElementById('creationDate').value = supplier.creationDate;
        }

        // Clear form
        function clearForm() {
            document.getElementById('supplierId').value = '';
            document.getElementById('supplierSapNo').value = '';
            document.getElementById('supplierTitle1').value = '';
            document.getElementById('supplierTitle2').value = '';
            document.getElementById('supplierStatusNo').value = '';
            document.getElementById('avgDeliveryTime').value = '';
            document.getElementById('createdBy').value = '-';
            document.getElementById('creationDate').value = '-';
        }

        // Enable form fields
        function enableForm() {
            document.querySelectorAll('.form-control').forEach(input => {
                input.disabled = false;
            });
            // ID field should always be readonly
            document.getElementById('supplierId').disabled = true;

            // Show dropdown, hide text display for status
            document.getElementById('supplierStatusNo').style.display = 'block';
            document.getElementById('supplierStatusText').style.display = 'none';
        }

        // Disable form fields (read-only mode)
        function disableForm() {
            document.querySelectorAll('.form-control').forEach(input => {
                input.disabled = true;
            });
        }

        // Get status title from status number
        // Per Data Structure IMMA.xlsx - Supplier Status:
        // 1 = Active, 2 = Disqualified, 3 = Inactive
        function getStatusTitle(statusNo) {
            const statusMap = {
                '1': 'Aktif',
                '2': 'Diskalifiye',
                '3': 'Pasif'
            };
            return statusMap[statusNo] || '';
        }

        // Save button handler
        document.getElementById('saveBtn').addEventListener('click', function() {
            // Get form values
            const sapNo = document.getElementById('supplierSapNo').value.trim();
            const title1 = document.getElementById('supplierTitle1').value.trim();
            const title2 = document.getElementById('supplierTitle2').value.trim();
            const statusNo = document.getElementById('supplierStatusNo').value;
            const avgDelivery = document.getElementById('avgDeliveryTime').value;

            // Validation
            if (!sapNo) {
                alert('SAP TedarikÃ§i No zorunlu alandÄ±r.');
                document.getElementById('supplierSapNo').focus();
                return;
            }
            if (!title1) {
                alert('TedarikÃ§i ÃœnvanÄ± 1 zorunlu alandÄ±r.');
                document.getElementById('supplierTitle1').focus();
                return;
            }
            if (!statusNo) {
                alert('TedarikÃ§i Durumu zorunlu alandÄ±r.');
                document.getElementById('supplierStatusNo').focus();
                return;
            }

            const statusTitle = getStatusTitle(statusNo);

            // Determine action
            if (currentMode === 'create') {
                // Create new supplier
                if (confirm(`Yeni tedarikÃ§i oluÅŸturulacak:\n\nSAP No: ${sapNo}\nÃœnvan: ${title1}\nDurum: ${statusTitle}\n\nDevam etmek istiyor musunuz?`)) {
                    // In real app: POST /api/suppliers
                    alert(`âœ… TedarikÃ§i baÅŸarÄ±yla oluÅŸturuldu!\n\nSAP No: ${sapNo}\nÃœnvan: ${title1}\nDurum: ${statusTitle}`);

                    // Redirect to list
                    window.location.href = 'supplier-list.html';
                }
            } else if (currentMode === 'edit') {
                // Update existing supplier
                if (confirm(`TedarikÃ§i gÃ¼ncellenecek:\n\nID: ${currentSupplierId}\nSAP No: ${sapNo}\nÃœnvan: ${title1}\nDurum: ${statusTitle}\n\nDevam etmek istiyor musunuz?`)) {
                    // In real app: PUT /api/suppliers/{id}
                    alert(`âœ… TedarikÃ§i baÅŸarÄ±yla gÃ¼ncellendi!\n\nID: ${currentSupplierId}\nSAP No: ${sapNo}\nÃœnvan: ${title1}\nDurum: ${statusTitle}`);

                    // Redirect to list
                    window.location.href = 'supplier-list.html';
                }
            }
        });
    </script>
</body>
</html>
